"use strict";exports.id=110,exports.ids=[110],exports.modules={1110:(e,r,i)=>{i.r(r),i.d(r,{default:()=>ti});var n=Object.defineProperty,o=(e,r)=>n(e,"name",{value:r,configurable:!0}),l=(()=>{for(var e=new Uint8Array(128),r=0;r<64;r++)e[r<26?r+65:r<52?r+71:r<62?r-4:4*r-205]=r;return r=>{for(var i=r.length,n=new Uint8Array((i-("="==r[i-1])-("="==r[i-2]))*3/4|0),o=0,l=0;o<i;){var u=e[r.charCodeAt(o++)],c=e[r.charCodeAt(o++)],f=e[r.charCodeAt(o++)],g=e[r.charCodeAt(o++)];n[l++]=u<<2|c>>4,n[l++]=c<<4|f>>2,n[l++]=f<<6|g}return n}})();function u(e){return e*Math.PI/180}function c(e){return 180*e/Math.PI}function f(e,r,i){return r>i?f(e,i,r):Math.min(Math.max(e,r),i)}function g(e,r,i){if("number"==typeof e&&"number"==typeof r)return e+(r-e)*i;if(e instanceof A&&r instanceof A||e instanceof v&&r instanceof v)return e.lerp(r,i);throw Error(`Bad value for lerp(): ${e}, ${r}. Only number, Vec2 and Color is supported.`)}function m(e,r,i,n,o){return n+(e-r)/(i-r)*(o-n)}function w(e,r,i,n,o){return f(m(e,r,i,n,o),n,o)}o(u,"deg2rad"),o(c,"rad2deg"),o(f,"clamp"),o(g,"lerp"),o(m,"map"),o(w,"mapc");var A=class e{static{o(this,"Vec2")}constructor(e=0,r=e){this.x=0,this.y=0,this.x=e,this.y=r}static fromAngle(r){let i=u(r);return new e(Math.cos(i),Math.sin(i))}static{this.LEFT=new e(-1,0)}static{this.RIGHT=new e(1,0)}static{this.UP=new e(0,-1)}static{this.DOWN=new e(0,1)}clone(){return new e(this.x,this.y)}add(...r){let i=V(...r);return new e(this.x+i.x,this.y+i.y)}sub(...r){let i=V(...r);return new e(this.x-i.x,this.y-i.y)}scale(...r){let i=V(...r);return new e(this.x*i.x,this.y*i.y)}dist(...e){let r=V(...e);return this.sub(r).len()}sdist(...e){let r=V(...e);return this.sub(r).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let r=this.len();return 0===r?new e(0):this.scale(1/r)}normal(){return new e(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let r=V(...e);return c(Math.atan2(this.y-r.y,this.x-r.x))}angleBetween(...e){let r=V(...e);return c(Math.atan2(this.cross(r),this.dot(r)))}lerp(r,i){return new e(g(this.x,r.x,i),g(this.y,r.y,i))}slerp(e,r){let i=this.dot(e),n=this.cross(e),o=Math.atan2(n,i);return this.scale(Math.sin((1-r)*o)).add(e.scale(Math.sin(r*o))).scale(1/n)}isZero(){return 0===this.x&&0===this.y}toFixed(r){return new e(Number(this.x.toFixed(r)),Number(this.y.toFixed(r)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new z(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}};function V(...e){if(1===e.length){if(e[0]instanceof A)return new A(e[0].x,e[0].y);if(Array.isArray(e[0])&&2===e[0].length)return new A(...e[0])}return new A(...e)}o(V,"vec2");var v=class e{static{o(this,"Color")}constructor(e,r,i){this.r=255,this.g=255,this.b=255,this.r=f(e,0,255),this.g=f(r,0,255),this.b=f(i,0,255)}static fromArray(r){return new e(r[0],r[1],r[2])}static fromHex(r){if("number"==typeof r)return new e(r>>16&255,r>>8&255,r>>0&255);if("string"==typeof r){let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return new e(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16))}throw Error("Invalid hex color format")}static fromHSL(r,i,n){if(0==i)return new e(255*n,255*n,255*n);let l=o((e,r,i)=>(i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(r-e)*6*i:i<.5?r:i<2/3?e+(r-e)*(2/3-i)*6:e),"hue2rgb"),u=n<.5?n*(1+i):n+i-n*i,c=2*n-u;return new e(Math.round(255*l(c,u,r+1/3)),Math.round(255*l(c,u,r)),Math.round(255*l(c,u,r-1/3)))}static{this.RED=new e(255,0,0)}static{this.GREEN=new e(0,255,0)}static{this.BLUE=new e(0,0,255)}static{this.YELLOW=new e(255,255,0)}static{this.MAGENTA=new e(255,0,255)}static{this.CYAN=new e(0,255,255)}static{this.WHITE=new e(255,255,255)}static{this.BLACK=new e(0,0,0)}clone(){return new e(this.r,this.g,this.b)}lighten(r){return new e(this.r+r,this.g+r,this.b+r)}darken(e){return this.lighten(-e)}invert(){return new e(255-this.r,255-this.g,255-this.b)}mult(r){return new e(this.r*r.r/255,this.g*r.g/255,this.b*r.b/255)}lerp(r,i){return new e(g(this.r,r.r,i),g(this.g,r.g,i),g(this.b,r.b,i))}toHSL(){let e=this.r/255,r=this.g/255,i=this.b/255,n=Math.max(e,r,i),o=Math.min(e,r,i),l=(n+o)/2,u=l,c=l;if(n==o)l=u=0;else{let f=n-o;switch(u=c>.5?f/(2-n-o):f/(n+o),n){case e:l=(r-i)/f+(r<i?6:0);break;case r:l=(i-e)/f+2;break;case i:l=(e-r)/f+4}l/=6}return[l,u,c]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+(16777216+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}};function y(...e){if(0===e.length)return new v(255,255,255);if(1===e.length){if(e[0]instanceof v)return e[0].clone();if("string"==typeof e[0])return v.fromHex(e[0]);if(Array.isArray(e[0])&&3===e[0].length)return v.fromArray(e[0])}return new v(...e)}o(y,"rgb");var x=o((e,r,i)=>v.fromHSL(e,r,i),"hsl2rgb"),E=class e{static{o(this,"Quad")}constructor(e,r,i,n){this.x=0,this.y=0,this.w=1,this.h=1,this.x=e,this.y=r,this.w=i,this.h=n}scale(r){return new e(this.x+this.w*r.x,this.y+this.h*r.y,this.w*r.w,this.h*r.h)}pos(){return new A(this.x,this.y)}clone(){return new e(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function S(e,r,i,n){return new E(e,r,i,n)}o(S,"quad");var R=class e{static{o(this,"Mat4")}constructor(e){this.m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e&&(this.m=e)}static translate(r){return new e([1,0,0,0,0,1,0,0,0,0,1,0,r.x,r.y,0,1])}static scale(r){return new e([r.x,0,0,0,0,r.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(r){let i=Math.cos(r=u(-r)),n=Math.sin(r);return new e([1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1])}static rotateY(r){let i=Math.cos(r=u(-r)),n=Math.sin(r);return new e([i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1])}static rotateZ(r){let i=Math.cos(r=u(-r)),n=Math.sin(r);return new e([i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){let r=Math.cos(e=u(-e)),i=Math.sin(e),n=this.m[0],o=this.m[1],l=this.m[4],c=this.m[5];return this.m[0]=n*r+o*i,this.m[1]=-n*i+o*r,this.m[4]=l*r+c*i,this.m[5]=-l*i+c*r,this}mult(r){let i=[];for(let e=0;e<4;e++)for(let n=0;n<4;n++)i[4*e+n]=this.m[0+n]*r.m[4*e+0]+this.m[4+n]*r.m[4*e+1]+this.m[8+n]*r.m[4*e+2]+this.m[12+n]*r.m[4*e+3];return new e(i)}multVec2(e){return new A(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new A(this.m[12],this.m[13])}getScale(){if(0!=this.m[0]||0!=this.m[1]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],r=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new A(r,e/r)}if(0==this.m[4]&&0==this.m[5])return new A(0,0);{let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],r=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new A(e/r,r)}}getRotation(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return c(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}if(0==this.m[4]&&0==this.m[5])return 0;{let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return c(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}}getSkew(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new A(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}if(0==this.m[4]&&0==this.m[5])return new A(0,0);{let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new A(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}}invert(){let r=[],i=this.m[10]*this.m[15]-this.m[14]*this.m[11],n=this.m[9]*this.m[15]-this.m[13]*this.m[11],o=this.m[9]*this.m[14]-this.m[13]*this.m[10],l=this.m[8]*this.m[15]-this.m[12]*this.m[11],u=this.m[8]*this.m[14]-this.m[12]*this.m[10],c=this.m[8]*this.m[13]-this.m[12]*this.m[9],f=this.m[6]*this.m[15]-this.m[14]*this.m[7],g=this.m[5]*this.m[15]-this.m[13]*this.m[7],m=this.m[5]*this.m[14]-this.m[13]*this.m[6],w=this.m[4]*this.m[15]-this.m[12]*this.m[7],A=this.m[4]*this.m[14]-this.m[12]*this.m[6],V=this.m[5]*this.m[15]-this.m[13]*this.m[7],v=this.m[4]*this.m[13]-this.m[12]*this.m[5],y=this.m[6]*this.m[11]-this.m[10]*this.m[7],x=this.m[5]*this.m[11]-this.m[9]*this.m[7],E=this.m[5]*this.m[10]-this.m[9]*this.m[6],S=this.m[4]*this.m[11]-this.m[8]*this.m[7],R=this.m[4]*this.m[10]-this.m[8]*this.m[6],P=this.m[4]*this.m[9]-this.m[8]*this.m[5];r[0]=this.m[5]*i-this.m[6]*n+this.m[7]*o,r[4]=-(this.m[4]*i-this.m[6]*l+this.m[7]*u),r[8]=this.m[4]*n-this.m[5]*l+this.m[7]*c,r[12]=-(this.m[4]*o-this.m[5]*u+this.m[6]*c),r[1]=-(this.m[1]*i-this.m[2]*n+this.m[3]*o),r[5]=this.m[0]*i-this.m[2]*l+this.m[3]*u,r[9]=-(this.m[0]*n-this.m[1]*l+this.m[3]*c),r[13]=this.m[0]*o-this.m[1]*u+this.m[2]*c,r[2]=this.m[1]*f-this.m[2]*g+this.m[3]*m,r[6]=-(this.m[0]*f-this.m[2]*w+this.m[3]*A),r[10]=this.m[0]*V-this.m[1]*w+this.m[3]*v,r[14]=-(this.m[0]*m-this.m[1]*A+this.m[2]*v),r[3]=-(this.m[1]*y-this.m[2]*x+this.m[3]*E),r[7]=this.m[0]*y-this.m[2]*S+this.m[3]*R,r[11]=-(this.m[0]*x-this.m[1]*S+this.m[3]*P),r[15]=this.m[0]*E-this.m[1]*R+this.m[2]*P;let T=this.m[0]*r[0]+this.m[1]*r[4]+this.m[2]*r[8]+this.m[3]*r[12];for(let e=0;e<4;e++)for(let i=0;i<4;i++)r[4*e+i]*=1/T;return new e(r)}clone(){return new e([...this.m])}toString(){return this.m.toString()}};function P(e,r,i,n=e=>-Math.cos(e)){return e+(n(i)+1)/2*(r-e)}o(P,"wave");var T=class{static{o(this,"RNG")}constructor(e){this.seed=e}gen(){return this.seed=(1103515245*this.seed+12345)%2147483648,this.seed/2147483648}genNumber(e,r){return e+this.gen()*(r-e)}genVec2(e,r){return new A(this.genNumber(e.x,r.x),this.genNumber(e.y,r.y))}genColor(e,r){return new v(this.genNumber(e.r,r.r),this.genNumber(e.g,r.g),this.genNumber(e.b,r.b))}genAny(...e){if(0===e.length)return this.gen();if(1===e.length){if("number"==typeof e[0])return this.genNumber(0,e[0]);if(e[0]instanceof A)return this.genVec2(V(0,0),e[0]);if(e[0]instanceof v)return this.genColor(y(0,0,0),e[0])}else if(2===e.length){if("number"==typeof e[0]&&"number"==typeof e[1])return this.genNumber(e[0],e[1]);if(e[0]instanceof A&&e[1]instanceof A)return this.genVec2(e[0],e[1]);if(e[0]instanceof v&&e[1]instanceof v)return this.genColor(e[0],e[1])}}},B=new T(Date.now());function F(e){return null!=e&&(B.seed=e),B.seed}function C(...e){return B.genAny(...e)}function D(...e){return Math.floor(C(...e))}function I(e){return C()<=e}function k(e){return e[D(e.length)]}function U(e,r){return e.pos.x+e.width>r.pos.x&&e.pos.x<r.pos.x+r.width&&e.pos.y+e.height>r.pos.y&&e.pos.y<r.pos.y+r.height}function N(e,r){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||r.p1.x===r.p2.x&&r.p1.y===r.p2.y)return null;let i=(r.p2.y-r.p1.y)*(e.p2.x-e.p1.x)-(r.p2.x-r.p1.x)*(e.p2.y-e.p1.y);if(0===i)return null;let n=((r.p2.x-r.p1.x)*(e.p1.y-r.p1.y)-(r.p2.y-r.p1.y)*(e.p1.x-r.p1.x))/i,o=((e.p2.x-e.p1.x)*(e.p1.y-r.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-r.p1.x))/i;return n<0||n>1||o<0||o>1?null:n}function L(e,r){let i=N(e,r);return i?V(e.p1.x+i*(e.p2.x-e.p1.x),e.p1.y+i*(e.p2.y-e.p1.y)):null}function O(e,r){if(G(e,r.p1)||G(e,r.p2))return!0;let i=e.points();return!!L(r,new Q(i[0],i[1]))||!!L(r,new Q(i[1],i[2]))||!!L(r,new Q(i[2],i[3]))||!!L(r,new Q(i[3],i[0]))}function G(e,r){return r.x>e.pos.x&&r.x<e.pos.x+e.width&&r.y>e.pos.y&&r.y<e.pos.y+e.height}function q(e,r){let i=r.sub(e.p1),n=e.p2.sub(e.p1);if(Math.abs(i.cross(n))>Number.EPSILON)return!1;let o=i.dot(n)/n.dot(n);return o>=0&&o<=1}function H(e,r){let i=e.p2.sub(e.p1),n=i.dot(i),o=e.p1.sub(r.center),l=2*i.dot(o),u=l*l-4*n*(o.dot(o)-r.radius*r.radius);if(n<=Number.EPSILON||u<0)return!1;if(0==u){let e=-l/(2*n);if(e>=0&&e<=1)return!0}else{let e=(-l+Math.sqrt(u))/(2*n),r=(-l-Math.sqrt(u))/(2*n);if(e>=0&&e<=1||r>=0&&r<=1)return!0}return K(r,e.p1)}function K(e,r){return e.center.sdist(r)<e.radius*e.radius}function Y(e,r){let i=r.pts[r.pts.length-1];for(let n of r.pts){if(H(new Q(i,n),e))return!0;i=n}return!!K(e,r.pts[0])||j(r,e.center)}function j(e,r){let i=!1,n=e.pts;for(let e=0,o=n.length-1;e<n.length;o=e++)n[e].y>r.y!=n[o].y>r.y&&r.x<(n[o].x-n[e].x)*(r.y-n[e].y)/(n[o].y-n[e].y)+n[e].x&&(i=!i);return i}o(F,"randSeed"),o(C,"rand"),o(D,"randi"),o(I,"chance"),o(k,"choose"),o(U,"testRectRect"),o(N,"testLineLineT"),o(L,"testLineLine"),o(O,"testRectLine"),o(G,"testRectPoint"),o(q,"testLinePoint"),o(H,"testLineCircle"),o(K,"testCirclePoint"),o(Y,"testCirclePolygon"),o(j,"testPolygonPoint");var Q=class e{static{o(this,"Line")}constructor(e,r){this.p1=e.clone(),this.p2=r.clone()}transform(r){return new e(r.multVec2(this.p1),r.multVec2(this.p2))}bbox(){return z.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new e(this.p1,this.p2)}},z=class e{static{o(this,"Rect")}constructor(e,r,i){this.pos=e.clone(),this.width=r,this.height=i}static fromPoints(r,i){return new e(r.clone(),i.x-r.x,i.y-r.y)}center(){return new A(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new W(this.points().map(r=>e.multVec2(r)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new e(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let r=this.pos,i=this.pos.add(this.width,this.height),n=Math.max(r.x-e.x,0,e.x-i.x),o=Math.max(r.y-e.y,0,e.y-i.y);return n*n+o*o}},J=class e{static{o(this,"Circle")}constructor(e,r){this.center=e.clone(),this.radius=r}transform(e){return new X(this.center,this.radius,this.radius).transform(e)}bbox(){return z.fromPoints(this.center.sub(V(this.radius)),this.center.add(V(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new e(this.center,this.radius)}},X=class e{static{o(this,"Ellipse")}constructor(e,r,i){this.center=e.clone(),this.radiusX=r,this.radiusY=i}transform(r){return new e(r.multVec2(this.center),r.m[0]*this.radiusX,r.m[5]*this.radiusY)}bbox(){return z.fromPoints(this.center.sub(V(this.radiusX,this.radiusY)),this.center.add(V(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new e(this.center,this.radiusX,this.radiusY)}},W=class e{static{o(this,"Polygon")}constructor(e){if(e.length<3)throw Error("Polygons should have at least 3 vertices");this.pts=e}transform(r){return new e(this.pts.map(e=>r.multVec2(e)))}bbox(){let e=V(Number.MAX_VALUE),r=V(-Number.MAX_VALUE);for(let i of this.pts)e.x=Math.min(e.x,i.x),r.x=Math.max(r.x,i.x),e.y=Math.min(e.y,i.y),r.y=Math.max(r.y,i.y);return z.fromPoints(e,r)}area(){let e=0,r=this.pts.length;for(let i=0;i<r;i++){let n=this.pts[i],o=this.pts[(i+1)%r];e+=n.x*o.y*.5,e-=o.x*n.y*.5}return Math.abs(e)}clone(){return new e(this.pts.map(e=>e.clone()))}};function Z(e,r){let i=Number.MAX_VALUE,n=V(0);for(let o of[e,r])for(let l=0;l<o.pts.length;l++){let u=o.pts[l],c=o.pts[(l+1)%o.pts.length].sub(u).normal().unit(),f=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let r=0;r<e.pts.length;r++){let i=e.pts[r].dot(c);f=Math.min(f,i),g=Math.max(g,i)}let m=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let e=0;e<r.pts.length;e++){let i=r.pts[e].dot(c);m=Math.min(m,i),w=Math.max(w,i)}let A=Math.min(g,w)-Math.max(f,m);if(A<0)return null;if(A<Math.abs(i)){let e=w-f,r=m-g;i=Math.abs(e)<Math.abs(r)?e:r,n=c.scale(i)}}return n}o(Z,"sat");var _=class extends Map{static{o(this,"Registry")}constructor(...e){super(...e),this.lastID=0}push(e){let r=this.lastID;return this.set(r,e),this.lastID++,r}pushd(e){let r=this.push(e);return()=>this.delete(r)}},$=class e{static{o(this,"EventController")}constructor(e){this.paused=!1,this.cancel=e}static join(r){let i=new e(()=>r.forEach(e=>e.cancel()));return Object.defineProperty(i,"paused",{get:()=>r[0].paused,set:e=>r.forEach(r=>r.paused=e)}),i.paused=!1,i}},ee=class{static{o(this,"Event")}add(e){let r=new $(this.handlers.pushd((...i)=>{r.paused||e(...i)}));return r}addOnce(e){let r=this.add((...i)=>{r.cancel(),e(...i)});return r}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(r=>r(...e))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}constructor(){this.handlers=new _}},et=class{static{o(this,"EventHandler")}on(e,r){return this.handlers[e]||(this.handlers[e]=new ee),this.handlers[e].add(r)}onOnce(e,r){let i=this.on(e,(...e)=>{i.cancel(),r(...e)});return i}next(e){return new Promise(r=>{this.onOnce(e,(...e)=>r(e[0]))})}trigger(e,...r){this.handlers[e]&&this.handlers[e].trigger(...r)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}constructor(){this.handlers={}}};function er(e,r){if(e===r)return!0;let i=typeof e,n=typeof r;if(i!==n)return!1;if("object"===i&&"object"===n&&null!==e&&null!==r){if(Array.isArray(e)!==Array.isArray(r))return!1;let i=Object.keys(e),n=Object.keys(r);if(i.length!==n.length)return!1;for(let n of i)if(!er(e[n],r[n]))return!1;return!0}return!1}function ei(e){let r=window.atob(e),i=r.length,n=new Uint8Array(i);for(let e=0;e<i;e++)n[e]=r.charCodeAt(e);return n.buffer}function en(e){return ei(e.split(",")[1])}function es(e,r){let i=document.createElement("a");i.href=r,i.download=e,i.click()}function eo(e,r){es(e,"data:text/plain;charset=utf-8,"+r)}function ea(e,r){eo(e,JSON.stringify(r))}function eh(e,r){let i=URL.createObjectURL(r);es(e,i),URL.revokeObjectURL(i)}o(er,"deepEq"),o(ei,"base64ToArrayBuffer"),o(en,"dataURLToArrayBuffer"),o(es,"download"),o(eo,"downloadText"),o(ea,"downloadJSON"),o(eh,"downloadBlob");var el=o(e=>e.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),eu=o(e=>e.split(".").slice(0,-1).join("."),"getFileName");function ed(e,r){return(...i)=>{let n=i.length;return n===e.length?e(...i):n===r.length?r(...i):void 0}}o(ed,"overload2");var ec=(()=>{let e=0;return()=>e++})(),ef=o(e=>e instanceof Error?e.message:String(e),"getErrorMessage"),ep=class{static{o(this,"BinaryHeap")}constructor(e=(e,r)=>e<r){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(0===this._items.length)return null;let e=this._items[0],r=this._items.pop();return 0!==this._items.length&&(this._items[0]=r,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let r=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[r])&&this._items[e]>=this._items[r])break;this.swap(e,r),e=r}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let r=2*e+1;if(r<this._items.length-1&&!this._compareFn(this._items[r],this._items[r+1])&&++r,this._compareFn(this._items[e],this._items[r]))break;this.swap(e,r),e=r}}swap(e,r){[this._items[e],this._items[r]]=[this._items[r],this._items[e]]}get length(){return this._items.length}},eg=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function em(e){if("string"!=typeof e)throw TypeError("string cannot be undefined or null");let r=[],i=0,n=0;for(;i<e.length;){if(n+=ew(i+n,e),eb(e[i+n])&&n++,ex(e[i+n])&&n++,eE(e[i+n])&&n++,eR(e[i+n])){n++;continue}r.push(e.substring(i,i+n)),i+=n,n=0}return r}function ew(e,r){let i=r[e];if(!eA(i)||e===r.length-1)return 1;let n=i+r[e+1],o=r.substring(e+2,e+5);return eV(n)&&eV(o)?4:ev(n)&&eS(o)?r.slice(e).indexOf(String.fromCodePoint(917631))+2:ey(o)?4:2}function eA(e){return e&&eP(e[0].charCodeAt(0),55296,56319)}function eV(e){return eP(eM(e),127462,127487)}function ev(e){return eP(eM(e),127988,127988)}function ey(e){return eP(eM(e),127995,127999)}function ex(e){return"string"==typeof e&&eP(e.charCodeAt(0),65024,65039)}function eE(e){return"string"==typeof e&&eP(e.charCodeAt(0),8400,8447)}function eS(e){let r=e.codePointAt(0);return"string"==typeof e&&"number"==typeof r&&eP(r,917504,917631)}function eb(e){return"string"==typeof e&&eg.includes(e.charCodeAt(0))}function eR(e){return"string"==typeof e&&8205===e.charCodeAt(0)}function eM(e){return(e.charCodeAt(0)-55296<<10)+(e.charCodeAt(1)-56320)+65536}function eP(e,r,i){return e>=r&&e<=i}o(em,"runes"),o(ew,"nextUnits"),o(eA,"isFirstOfSurrogatePair"),o(eV,"isRegionalIndicator"),o(ev,"isSubdivisionFlag"),o(ey,"isFitzpatrickModifier"),o(ex,"isVariationSelector"),o(eE,"isDiacriticalMark"),o(eS,"isSupplementarySpecialpurposePlane"),o(eb,"isGrapheme"),o(eR,"isZeroWidthJoiner"),o(eM,"codePointFromSurrogatePair"),o(eP,"betweenInclusive");var eT={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},eB=class{static{o(this,"ButtonState")}update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}constructor(){this.pressed=new Set([]),this.pressedRepeat=new Set([]),this.released=new Set([]),this.down=new Set([])}},eF=class{static{o(this,"GamepadState")}constructor(){this.buttonState=new eB,this.stickState=new Map}},eC=class{static{o(this,"FPSCounter")}tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((e,r)=>e+r)/this.dts.length)),this.dts=[])}constructor(){this.dts=[],this.timer=0,this.fps=0}},eD=o(e=>{if(!e.canvas)throw Error("Please provide a canvas");let r={canvas:e.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new eC,timeScale:1,skipTime:!1,numFrames:0,mousePos:new A(0),mouseDeltaPos:new A(0),keyState:new eB,mouseState:new eB,mergedGamepadState:new eF,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new et};function i(){return r.dt*r.timeScale}function n(){return r.time}function l(){return r.fpsCounter.fps}function u(){return r.numFrames}function c(){return r.canvas.toDataURL()}function f(e){r.canvas.style.cursor=e}function g(){return r.canvas.style.cursor}function w(e){if(e)try{let e=r.canvas.requestPointerLock();e.catch&&e.catch(e=>console.error(e))}catch(e){console.error(e)}else document.exitPointerLock()}function V(){return!!document.pointerLockElement}function v(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function y(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function x(){return document.fullscreenElement||document.webkitFullscreenElement}function E(e=!0){e?v(r.canvas):y()}function S(){return!!x()}function R(){for(let e in r.stopped=!0,ey)r.canvas.removeEventListener(e,ey[e]);for(let e in ex)document.removeEventListener(e,ex[e]);for(let e in eE)window.removeEventListener(e,eE[e]);eP.disconnect()}function P(n){null!==r.loopID&&cancelAnimationFrame(r.loopID);let l=0,u=o(o=>{if(r.stopped)return;if("visible"!==document.visibilityState){r.loopID=requestAnimationFrame(u);return}let c=o/1e3,f=c-r.realTime,g=e.maxFPS?1/e.maxFPS:0;r.realTime=c,(l+=f)>g&&(r.skipTime||(r.dt=l,r.time+=i(),r.fpsCounter.tick(r.dt)),l=0,r.skipTime=!1,r.numFrames++,em(),n(),ew()),r.loopID=requestAnimationFrame(u)},"frame");u(0)}function T(){return"ontouchstart"in window||navigator.maxTouchPoints>0}function B(){return r.mousePos.clone()}function F(){return r.mouseDeltaPos.clone()}function C(e="left"){return r.mouseState.pressed.has(e)}function D(e="left"){return r.mouseState.down.has(e)}function I(e="left"){return r.mouseState.released.has(e)}function k(){return r.isMouseMoved}function U(e){return void 0===e?r.keyState.pressed.size>0:r.keyState.pressed.has(e)}function N(e){return void 0===e?r.keyState.pressedRepeat.size>0:r.keyState.pressedRepeat.has(e)}function L(e){return void 0===e?r.keyState.down.size>0:r.keyState.down.has(e)}function O(e){return void 0===e?r.keyState.released.size>0:r.keyState.released.has(e)}function G(e){return void 0===e?r.mergedGamepadState.buttonState.pressed.size>0:r.mergedGamepadState.buttonState.pressed.has(e)}function q(e){return void 0===e?r.mergedGamepadState.buttonState.down.size>0:r.mergedGamepadState.buttonState.down.has(e)}function H(e){return void 0===e?r.mergedGamepadState.buttonState.released.size>0:r.mergedGamepadState.buttonState.released.has(e)}function K(e){return r.events.on("resize",e)}o(i,"dt"),o(n,"time"),o(l,"fps"),o(u,"numFrames"),o(c,"screenshot"),o(f,"setCursor"),o(g,"getCursor"),o(w,"setCursorLocked"),o(V,"isCursorLocked"),o(v,"enterFullscreen"),o(y,"exitFullscreen"),o(x,"getFullscreenElement"),o(E,"setFullscreen"),o(S,"isFullscreen"),o(R,"quit"),o(P,"run"),o(T,"isTouchscreen"),o(B,"mousePos"),o(F,"mouseDeltaPos"),o(C,"isMousePressed"),o(D,"isMouseDown"),o(I,"isMouseReleased"),o(k,"isMouseMoved"),o(U,"isKeyPressed"),o(N,"isKeyPressedRepeat"),o(L,"isKeyDown"),o(O,"isKeyReleased"),o(G,"isGamepadButtonPressed"),o(q,"isGamepadButtonDown"),o(H,"isGamepadButtonReleased"),o(K,"onResize");let Y=ed(e=>r.events.on("keyDown",e),(e,i)=>r.events.on("keyDown",r=>r===e&&i(e))),j=ed(e=>r.events.on("keyPress",e),(e,i)=>r.events.on("keyPress",r=>r===e&&i(e))),Q=ed(e=>r.events.on("keyPressRepeat",e),(e,i)=>r.events.on("keyPressRepeat",r=>r===e&&i(e))),z=ed(e=>r.events.on("keyRelease",e),(e,i)=>r.events.on("keyRelease",r=>r===e&&i(e))),J=ed(e=>r.events.on("mouseDown",r=>e(r)),(e,i)=>r.events.on("mouseDown",r=>r===e&&i(r))),X=ed(e=>r.events.on("mousePress",r=>e(r)),(e,i)=>r.events.on("mousePress",r=>r===e&&i(r))),W=ed(e=>r.events.on("mouseRelease",r=>e(r)),(e,i)=>r.events.on("mouseRelease",r=>r===e&&i(r)));function Z(e){return r.events.on("mouseMove",()=>e(B(),F()))}function _(e){return r.events.on("charInput",e)}function $(e){return r.events.on("touchStart",e)}function ee(e){return r.events.on("touchMove",e)}function er(e){return r.events.on("touchEnd",e)}function ei(e){return r.events.on("scroll",e)}function en(e){return r.events.on("hide",e)}function es(e){return r.events.on("show",e)}function eo(e,i){return"function"==typeof e?r.events.on("gamepadButtonDown",e):"string"==typeof e&&"function"==typeof i?r.events.on("gamepadButtonDown",r=>r===e&&i(e)):void 0}function ea(e,i){return"function"==typeof e?r.events.on("gamepadButtonPress",e):"string"==typeof e&&"function"==typeof i?r.events.on("gamepadButtonPress",r=>r===e&&i(e)):void 0}function eh(e,i){return"function"==typeof e?r.events.on("gamepadButtonRelease",e):"string"==typeof e&&"function"==typeof i?r.events.on("gamepadButtonRelease",r=>r===e&&i(e)):void 0}function el(e,i){return r.events.on("gamepadStick",(r,n)=>r===e&&i(n))}function eu(e){r.events.on("gamepadConnect",e)}function ec(e){r.events.on("gamepadDisconnect",e)}function ef(e){return r.mergedGamepadState.stickState.get(e)||new A(0)}function ep(){return[...r.charInputted]}function eg(){return[...r.gamepads]}function em(){r.events.trigger("input"),r.keyState.down.forEach(e=>r.events.trigger("keyDown",e)),r.mouseState.down.forEach(e=>r.events.trigger("mouseDown",e)),ev()}function ew(){r.keyState.update(),r.mouseState.update(),r.mergedGamepadState.buttonState.update(),r.mergedGamepadState.stickState.forEach((e,i)=>{r.mergedGamepadState.stickState.set(i,new A(0))}),r.charInputted=[],r.isMouseMoved=!1,r.gamepadStates.forEach(e=>{e.buttonState.update(),e.stickState.forEach((r,i)=>{e.stickState.set(i,new A(0))})})}function eA(e){let i={index:e.index,isPressed:i=>r.gamepadStates.get(e.index).buttonState.pressed.has(i),isDown:i=>r.gamepadStates.get(e.index).buttonState.down.has(i),isReleased:i=>r.gamepadStates.get(e.index).buttonState.released.has(i),getStick:i=>r.gamepadStates.get(e.index).stickState.get(i)};return r.gamepads.push(i),r.gamepadStates.set(e.index,{buttonState:new eB,stickState:new Map([["left",new A(0)],["right",new A(0)]])}),i}function eV(e){r.gamepads=r.gamepads.filter(r=>r.index!==e.index),r.gamepadStates.delete(e.index)}function ev(){for(let e of navigator.getGamepads())e&&!r.gamepadStates.has(e.index)&&eA(e);for(let i of r.gamepads){let n=navigator.getGamepads()[i.index],o=(e.gamepads??{})[n.id]??eT[n.id]??eT.default,l=r.gamepadStates.get(i.index);for(let e=0;e<n.buttons.length;e++)n.buttons[e].pressed?(l.buttonState.down.has(o.buttons[e])||(r.mergedGamepadState.buttonState.press(o.buttons[e]),l.buttonState.press(o.buttons[e]),r.events.trigger("gamepadButtonPress",o.buttons[e])),r.events.trigger("gamepadButtonDown",o.buttons[e])):l.buttonState.down.has(o.buttons[e])&&(r.mergedGamepadState.buttonState.release(o.buttons[e]),l.buttonState.release(o.buttons[e]),r.events.trigger("gamepadButtonRelease",o.buttons[e]));for(let e in o.sticks){let i=o.sticks[e],u=new A(n.axes[i.x],n.axes[i.y]);l.stickState.set(e,u),r.mergedGamepadState.stickState.set(e,u),r.events.trigger("gamepadStick",e,u)}}}o(Z,"onMouseMove"),o(_,"onCharInput"),o($,"onTouchStart"),o(ee,"onTouchMove"),o(er,"onTouchEnd"),o(ei,"onScroll"),o(en,"onHide"),o(es,"onShow"),o(eo,"onGamepadButtonDown"),o(ea,"onGamepadButtonPress"),o(eh,"onGamepadButtonRelease"),o(el,"onGamepadStick"),o(eu,"onGamepadConnect"),o(ec,"onGamepadDisconnect"),o(ef,"getGamepadStick"),o(ep,"charInputted"),o(eg,"getGamepads"),o(em,"processInput"),o(ew,"resetInput"),o(eA,"registerGamepad"),o(eV,"removeGamepad"),o(ev,"processGamepad");let ey={},ex={},eE={},eS=e.pixelDensity||window.devicePixelRatio||1;ey.mousemove=e=>{let i=new A(e.offsetX,e.offsetY),n=new A(e.movementX,e.movementY);if(S()){let n=r.canvas.width/eS,o=r.canvas.height/eS,l=window.innerWidth,u=window.innerHeight;if(l/u>n/o){let r=u/o,c=(l-n*r)/2;i.x=m(e.offsetX-c,0,n*r,0,n),i.y=m(e.offsetY,0,o*r,0,o)}else{let r=l/n,c=(u-o*r)/2;i.x=m(e.offsetX,0,n*r,0,n),i.y=m(e.offsetY-c,0,o*r,0,o)}}r.events.onOnce("input",()=>{r.isMouseMoved=!0,r.mousePos=i,r.mouseDeltaPos=n,r.events.trigger("mouseMove")})};let eb=["left","middle","right","back","forward"];ey.mousedown=e=>{r.events.onOnce("input",()=>{let i=eb[e.button];i&&(r.mouseState.press(i),r.events.trigger("mousePress",i))})},ey.mouseup=e=>{r.events.onOnce("input",()=>{let i=eb[e.button];i&&(r.mouseState.release(i),r.events.trigger("mouseRelease",i))})};let eR=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),eM={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};for(let i in ey.keydown=e=>{eR.has(e.key)&&e.preventDefault(),r.events.onOnce("input",()=>{let i=eM[e.key]||e.key.toLowerCase();1===i.length?(r.events.trigger("charInput",i),r.charInputted.push(i)):"space"===i&&(r.events.trigger("charInput"," "),r.charInputted.push(" ")),e.repeat?(r.keyState.pressRepeat(i),r.events.trigger("keyPressRepeat",i)):(r.keyState.press(i),r.events.trigger("keyPressRepeat",i),r.events.trigger("keyPress",i))})},ey.keyup=e=>{r.events.onOnce("input",()=>{let i=eM[e.key]||e.key.toLowerCase();r.keyState.release(i),r.events.trigger("keyRelease",i)})},ey.touchstart=i=>{i.preventDefault(),r.events.onOnce("input",()=>{let n=[...i.changedTouches],o=r.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(r.mousePos=new A(n[0].clientX-o.x,n[0].clientY-o.y),r.mouseState.press("left"),r.events.trigger("mousePress","left")),n.forEach(e=>{r.events.trigger("touchStart",new A(e.clientX-o.x,e.clientY-o.y),e)})})},ey.touchmove=i=>{i.preventDefault(),r.events.onOnce("input",()=>{let n=[...i.changedTouches],o=r.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(r.mousePos=new A(n[0].clientX-o.x,n[0].clientY-o.y),r.events.trigger("mouseMove")),n.forEach(e=>{r.events.trigger("touchMove",new A(e.clientX-o.x,e.clientY-o.y),e)})})},ey.touchend=i=>{r.events.onOnce("input",()=>{let n=[...i.changedTouches],o=r.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(r.mousePos=new A(n[0].clientX-o.x,n[0].clientY-o.y),r.mouseState.release("left"),r.events.trigger("mouseRelease","left")),n.forEach(e=>{r.events.trigger("touchEnd",new A(e.clientX-o.x,e.clientY-o.y),e)})})},ey.touchcancel=i=>{r.events.onOnce("input",()=>{let n=[...i.changedTouches],o=r.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(r.mousePos=new A(n[0].clientX-o.x,n[0].clientY-o.y),r.mouseState.release("left"),r.events.trigger("mouseRelease","left")),n.forEach(e=>{r.events.trigger("touchEnd",new A(e.clientX-o.x,e.clientY-o.y),e)})})},ey.wheel=e=>{e.preventDefault(),r.events.onOnce("input",()=>{r.events.trigger("scroll",new A(e.deltaX,e.deltaY))})},ey.contextmenu=e=>e.preventDefault(),ex.visibilitychange=()=>{"visible"===document.visibilityState?(r.skipTime=!0,r.events.trigger("show")):r.events.trigger("hide")},eE.gamepadconnected=e=>{let i=eA(e.gamepad);r.events.onOnce("input",()=>{r.events.trigger("gamepadConnect",i)})},eE.gamepaddisconnected=e=>{let i=eg().filter(r=>r.index===e.gamepad.index)[0];eV(e.gamepad),r.events.onOnce("input",()=>{r.events.trigger("gamepadDisconnect",i)})},ey)r.canvas.addEventListener(i,ey[i]);for(let e in ex)document.addEventListener(e,ex[e]);for(let e in eE)window.addEventListener(e,eE[e]);let eP=new ResizeObserver(e=>{for(let i of e)if(i.target===r.canvas){if(r.lastWidth===r.canvas.offsetWidth&&r.lastHeight===r.canvas.offsetHeight)return;r.lastWidth=r.canvas.offsetWidth,r.lastHeight=r.canvas.offsetHeight,r.events.onOnce("input",()=>{r.events.trigger("resize")})}});return eP.observe(r.canvas),{dt:i,time:n,run:P,canvas:r.canvas,fps:l,numFrames:u,quit:R,setFullscreen:E,isFullscreen:S,setCursor:f,screenshot:c,getGamepads:eg,getCursor:g,setCursorLocked:w,isCursorLocked:V,isTouchscreen:T,mousePos:B,mouseDeltaPos:F,isKeyDown:L,isKeyPressed:U,isKeyPressedRepeat:N,isKeyReleased:O,isMouseDown:D,isMousePressed:C,isMouseReleased:I,isMouseMoved:k,isGamepadButtonPressed:G,isGamepadButtonDown:q,isGamepadButtonReleased:H,getGamepadStick:ef,charInputted:ep,onResize:K,onKeyDown:Y,onKeyPress:j,onKeyPressRepeat:Q,onKeyRelease:z,onMouseDown:J,onMousePress:X,onMouseRelease:W,onMouseMove:Z,onCharInput:_,onTouchStart:$,onTouchMove:ee,onTouchEnd:er,onScroll:ei,onHide:en,onShow:es,onGamepadButtonDown:eo,onGamepadButtonPress:ea,onGamepadButtonRelease:eh,onGamepadStick:el,onGamepadConnect:eu,onGamepadDisconnect:ec,events:r.events}},"default"),eI=class e{static{o(this,"Texture")}constructor(e,r,i,n={}){this.src=null,this.ctx=e;let o=e.gl;this.glTex=e.gl.createTexture(),e.onDestroy(()=>this.free()),this.width=r,this.height=i;let l={linear:o.LINEAR,nearest:o.NEAREST}[n.filter??e.opts.texFilter]??o.NEAREST,u={repeat:o.REPEAT,clampToEadge:o.CLAMP_TO_EDGE}[n.wrap]??o.CLAMP_TO_EDGE;this.bind(),r&&i&&o.texImage2D(o.TEXTURE_2D,0,o.RGBA,r,i,0,o.RGBA,o.UNSIGNED_BYTE,null),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,l),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,l),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,u),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,u),this.unbind()}static fromImage(r,i,n={}){let o=new e(r,i.width,i.height,n);return o.update(i),o.src=i,o}update(e,r=0,i=0){let n=this.ctx.gl;this.bind(),n.texSubImage2D(n.TEXTURE_2D,0,r,i,n.RGBA,n.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},ek=class{static{o(this,"FrameBuffer")}constructor(e,r,i,n={}){this.ctx=e;let o=e.gl;e.onDestroy(()=>this.free()),this.tex=new eI(e,r,i,n),this.glFramebuffer=o.createFramebuffer(),this.glRenderbuffer=o.createRenderbuffer(),this.bind(),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,r,i),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,this.tex.glTex,0),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,r=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,r),this.unbind();let i=4*this.width,n=new Uint8Array(i);for(let e=0;e<(this.height/2|0);e++){let o=e*i,l=(this.height-e-1)*i;n.set(r.subarray(o,o+i)),r.copyWithin(o,l,l+i),r.set(n,l)}return new ImageData(r,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),r=e.getContext("2d");return e.width=this.width,e.height=this.height,r.putImageData(this.toImageData(),0,0),e.toDataURL()}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},eU=class{static{o(this,"Shader")}constructor(e,r,i,n){this.ctx=e,e.onDestroy(()=>this.free());let o=e.gl,l=o.createShader(o.VERTEX_SHADER),u=o.createShader(o.FRAGMENT_SHADER);o.shaderSource(l,r),o.shaderSource(u,i),o.compileShader(l),o.compileShader(u);let c=o.createProgram();if(this.glProgram=c,o.attachShader(c,l),o.attachShader(c,u),n.forEach((e,r)=>o.bindAttribLocation(c,r,e)),o.linkProgram(c),!o.getProgramParameter(c,o.LINK_STATUS)){let e=o.getShaderInfoLog(l);if(e)throw Error("VERTEX SHADER "+e);let r=o.getShaderInfoLog(u);if(r)throw Error("FRAGMENT SHADER "+r)}o.deleteShader(l),o.deleteShader(u)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let r=this.ctx.gl;for(let i in e){let n=e[i],o=r.getUniformLocation(this.glProgram,i);"number"==typeof n?r.uniform1f(o,n):n instanceof R?r.uniformMatrix4fv(o,!1,new Float32Array(n.m)):n instanceof v?r.uniform3f(o,n.r,n.g,n.b):n instanceof A&&r.uniform2f(o,n.x,n.y)}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},eN=class{static{o(this,"BatchRenderer")}constructor(e,r,i,n){this.vqueue=[],this.iqueue=[],this.numDraws=0,this.curPrimitive=null,this.curTex=null,this.curShader=null,this.curUniform={};let o=e.gl;this.vertexFormat=r,this.ctx=e,this.stride=r.reduce((e,r)=>e+r.size,0),this.maxVertices=i,this.maxIndices=n,this.glVBuf=o.createBuffer(),e.pushArrayBuffer(this.glVBuf),o.bufferData(o.ARRAY_BUFFER,4*i,o.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=o.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),o.bufferData(o.ELEMENT_ARRAY_BUFFER,4*n,o.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,r,i,n,o=null,l={}){(e!==this.curPrimitive||o!==this.curTex||n!==this.curShader||!er(this.curUniform,l)||this.vqueue.length+r.length*this.stride>this.maxVertices||this.iqueue.length+i.length>this.maxIndices)&&this.flush();let u=this.vqueue.length/this.stride;for(let e of r)this.vqueue.push(e);for(let e of i)this.iqueue.push(e+u);this.curPrimitive=e,this.curShader=n,this.curTex=o,this.curUniform=l}flush(){if(!this.curPrimitive||!this.curShader||0===this.vqueue.length||0===this.iqueue.length)return;let e=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),this.curTex?.bind(),e.drawElements(this.curPrimitive,this.iqueue.length,e.UNSIGNED_SHORT,0),this.curTex?.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}};function eL(e){let r=[],i=o(i=>{r.push(i),e(i)},"push"),n=o(()=>{r.pop(),e(l()??null)},"pop"),l=o(()=>r[r.length-1],"cur");return[i,n,l]}function eO(e,r={}){let i=[];function n(e){i.push(e)}function l(){i.forEach(e=>e()),e.getExtension("WEBGL_lose_context").loseContext()}o(n,"onDestroy"),o(l,"destroy");let u=null;function c(r){if(er(r,u))return;u=r;let i=r.reduce((e,r)=>e+r.size,0);r.reduce((r,n,o)=>(e.vertexAttribPointer(o,n.size,e.FLOAT,!1,4*i,r),e.enableVertexAttribArray(o),r+4*n.size),0)}o(c,"setVertexFormat");let[f,g]=eL(r=>e.bindTexture(e.TEXTURE_2D,r)),[m,w]=eL(r=>e.bindBuffer(e.ARRAY_BUFFER,r)),[A,V]=eL(r=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)),[v,y]=eL(r=>e.bindFramebuffer(e.FRAMEBUFFER,r)),[x,E]=eL(r=>e.bindRenderbuffer(e.RENDERBUFFER,r)),[S,R]=eL(({x:r,y:i,w:n,h:o})=>{e.viewport(r,i,n,o)}),[P,T]=eL(r=>e.useProgram(r));return S({x:0,y:0,w:e.drawingBufferWidth,h:e.drawingBufferHeight}),{gl:e,opts:r,onDestroy:n,destroy:l,pushTexture2D:f,popTexture2D:g,pushArrayBuffer:m,popArrayBuffer:w,pushElementArrayBuffer:A,popElementArrayBuffer:V,pushFramebuffer:v,popFramebuffer:y,pushRenderbuffer:x,popRenderbuffer:E,pushViewport:S,popViewport:R,pushProgram:P,popProgram:T,setVertexFormat:c}}o(eL,"genStack"),o(eO,"initGfx");var eG=class e{static{o(this,"Asset")}constructor(e){this.loaded=!1,this.data=null,this.error=null,this.onLoadEvents=new ee,this.onErrorEvents=new ee,this.onFinishEvents=new ee,e.then(e=>{this.data=e,this.onLoadEvents.trigger(e)}).catch(e=>{if(this.error=e,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(e);else throw e}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(r){let i=new e(Promise.resolve(r));return i.data=r,i.loaded=!0,i}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},eq=class{static{o(this,"AssetBucket")}add(e,r){let i=e??this.lastUID+++"",n=new eG(r);return this.assets.set(i,n),n}addLoaded(e,r){let i=e??this.lastUID+++"",n=eG.loaded(r);return this.assets.set(i,n),n}get(e){return this.assets.get(e)}progress(){if(0===this.assets.size)return 1;let e=0;return this.assets.forEach(r=>{r.loaded&&e++}),e/this.assets.size}constructor(){this.assets=new Map,this.lastUID=0}};function eH(e){return fetch(e).then(r=>{if(!r.ok)throw Error(`Failed to fetch "${e}"`);return r})}function eK(e){return eH(e).then(e=>e.json())}function eY(e){return eH(e).then(e=>e.text())}function ej(e){return eH(e).then(e=>e.arrayBuffer())}function eQ(e){let r=new Image;return r.crossOrigin="anonymous",r.src=e,new Promise((i,n)=>{r.onload=()=>i(r),r.onerror=()=>n(Error(`Failed to load image from "${e}"`))})}o(eH,"fetchURL"),o(eK,"fetchJSON"),o(eY,"fetchText"),o(ej,"fetchArrayBuffer"),o(eQ,"loadImg");var ez=2*Math.PI/3,eJ=2*Math.PI/4.5,eX={linear:e=>e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>2.70158*e*e*e-1.70158*e*e,easeOutBack:e=>1+2.70158*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(7.189819*e-2.5949095)/2:(Math.pow(2*e-2,2)*(3.5949095*(2*e-2)+2.5949095)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*ez),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*ez)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-(Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*eJ))/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*eJ)/2+1,easeInBounce:e=>1-eX.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?(1-eX.easeOutBounce(1-2*e))/2:(1+eX.easeOutBounce(2*e-1))/2},eW=class{static{o(this,"TexPacker")}constructor(e,r,i){this.textures=[],this.x=0,this.y=0,this.curHeight=0,this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=r,this.canvas.height=i,this.textures=[eI.fromImage(e,this.canvas)],this.c2d=this.canvas.getContext("2d")}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height)throw Error(`Texture size (${e.width} x ${e.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(eI.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let r=this.textures[this.textures.length-1],i=new A(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.c2d.putImageData(e,i.x,i.y):this.c2d.drawImage(e,i.x,i.y),r.update(this.canvas),[r,new E(i.x/this.canvas.width,i.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}free(){for(let e of this.textures)e.free()}},eZ=l("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),e_=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",e$="topleft",e0="monospace",e1="linear",e2=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],e5=8192*e2.reduce((e,r)=>e+r.size,0),e4=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,e6=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,e8=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,e3=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,e7=new Set(["id","require"]),e9=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function te(e){switch(e){case"topleft":return new A(-1,-1);case"top":return new A(0,-1);case"topright":return new A(1,-1);case"left":return new A(-1,0);case"center":return new A(0,0);case"right":return new A(1,0);case"botleft":return new A(-1,1);case"bot":return new A(0,1);case"botright":return new A(1,1);default:return e}}function tt(e){switch(e){case"left":default:return 0;case"center":return .5;case"right":return 1}}function tr(e){return e.createBuffer(1,1,44100)}o(te,"anchorPt"),o(tt,"alignPt"),o(tr,"createEmptyAudioBuffer");var ti=o((e={})=>{var r;let i,n=e.root??document.body;n===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let l=e.canvas??(()=>{let e=document.createElement("canvas");return n.appendChild(e),e})(),B=e.scale??1,N=e.width&&e.height&&!e.stretch&&!e.letterbox;N?(l.width=e.width*B,l.height=e.height*B):(l.width=l.parentElement.offsetWidth,l.height=l.parentElement.offsetHeight);let K=["outline: none","cursor: default"];if(N){let e=l.width,r=l.height;K.push(`width: ${e}px`),K.push(`height: ${r}px`)}else K.push("width: 100%"),K.push("height: 100%");e.crisp&&(K.push("image-rendering: pixelated"),K.push("image-rendering: crisp-edges")),l.style.cssText=K.join(";");let X=e.pixelDensity||window.devicePixelRatio;l.width*=X,l.height*=X,l.tabIndex=0;let er=document.createElement("canvas");er.width=256,er.height=256;let ei=er.getContext("2d",{willReadFrequently:!0}),eg=eD({canvas:l,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS}),ew=[],eA=eg.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0}),eV=eO(eA,{texFilter:e.texFilter}),ev=(()=>{let r=tS(e8,e3),i=eI.fromImage(eV,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),n=e.width&&e.height?new ek(eV,e.width*X*B,e.height*X*B):new ek(eV,eA.drawingBufferWidth,eA.drawingBufferHeight),o=null,l=1;e.background&&(o=y(e.background),l=Array.isArray(e.background)?e.background[3]:1,eA.clearColor(o.r/255,o.g/255,o.b/255,l??1)),eA.enable(eA.BLEND),eA.blendFuncSeparate(eA.SRC_ALPHA,eA.ONE_MINUS_SRC_ALPHA,eA.ONE,eA.ONE_MINUS_SRC_ALPHA);let u=new eN(eV,e2,e5,12288),c=eI.fromImage(eV,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,defShader:r,defTex:i,frameBuffer:n,postShader:null,postShaderUniform:null,renderer:u,transform:new R,transformStack:[],bgTex:c,bgColor:o,bgAlpha:l,width:e.width??eA.drawingBufferWidth/X/B,height:e.height??eA.drawingBufferHeight/X/B,viewport:{x:0,y:0,width:eA.drawingBufferWidth,height:eA.drawingBufferHeight},fixed:!1}})();class ey{static{o(this,"SpriteData")}constructor(e,r,i={},n=null){this.frames=[new E(0,0,1,1)],this.anims={},this.slice9=null,this.tex=e,r&&(this.frames=r),this.anims=i,this.slice9=n}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(e,r={}){return"string"==typeof e?ey.fromURL(e,r):Promise.resolve(ey.fromImage(e,r))}static fromImage(e,r={}){let[i,n]=eS.packer.add(e);return new ey(i,r.frames?r.frames.map(e=>new E(n.x+e.x*n.w,n.y+e.y*n.h,e.w*n.w,e.h*n.h)):eH(r.sliceX||1,r.sliceY||1,n.x,n.y,n.w,n.h),r.anims,r.slice9)}static fromURL(e,r={}){return eQ(e).then(e=>ey.fromImage(e,r))}}class ex{static{o(this,"SoundData")}constructor(e){this.buf=e}static fromArrayBuffer(e){return new Promise((r,i)=>eE.ctx.decodeAudioData(e,r,i)).then(e=>new ex(e))}static fromURL(e){return el(e)?ex.fromArrayBuffer(en(e)):ej(e).then(e=>ex.fromArrayBuffer(e))}}let eE=(()=>{let e=new(window.AudioContext||window.webkitAudioContext),r=e.createGain();r.connect(e.destination);let i=new ex(tr(e));return e.decodeAudioData(eZ.buffer.slice(0)).then(e=>{i.buf=e}).catch(e=>{console.error("Failed to load burp: ",e)}),{ctx:e,masterNode:r,burpSnd:i}})(),eS={urlPrefix:"",sprites:new eq,fonts:new eq,bitmapFonts:new eq,sounds:new eq,shaders:new eq,custom:new eq,packer:new eW(eV,2048,2048),loaded:!1};function eb(e){return"string"!=typeof e||el(e)?e:eS.urlPrefix+e}o(eb,"fixURL");let eR={events:new et,objEvents:new et,root:rc([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new A(1),angle:0,shake:0,transform:new R}};function eM(e){return eS.custom.add(null,e)}function eP(){let e=[eS.sprites,eS.sounds,eS.shaders,eS.fonts,eS.bitmapFonts,eS.custom];return e.reduce((e,r)=>e+r.progress(),0)/e.length}function eT(e){return void 0!==e&&(eS.urlPrefix=e),eS.urlPrefix}function eB(e,r){return eS.custom.add(e,eK(r))}eR.root.use(rZ()),o(eM,"load"),o(eP,"loadProgress"),o(eT,"loadRoot"),o(eB,"loadJSON");class eF{static{o(this,"FontData")}constructor(e,r={}){if(this.filter=e1,this.outline=null,this.size=64,this.fontface=e,this.filter=r.filter??e1,this.size=r.size??64,this.size>256)throw Error("Max font size: 256");r.outline&&(this.outline={width:1,color:y(0,0,0)},"number"==typeof r.outline?this.outline.width=r.outline:"object"==typeof r.outline&&(r.outline.width&&(this.outline.width=r.outline.width),r.outline.color&&(this.outline.color=r.outline.color)))}}function eC(e,r,i={}){let n=new FontFace(e,"string"==typeof r?`url(${r})`:r);return document.fonts.add(n),eS.fonts.add(e,n.load().catch(e=>{throw Error(`Failed to load font from "${r}": ${e}`)}).then(e=>new eF(e,i)))}function eL(e,r,i,n,o={}){return eS.bitmapFonts.add(e,eQ(r).then(e=>tb(eI.fromImage(eV,e,o),i,n,o.chars??e_)))}function eH(e=1,r=1,i=0,n=0,o=1,l=1){let u=[],c=o/e,f=l/r;for(let o=0;o<r;o++)for(let r=0;r<e;r++)u.push(new E(i+r*c,n+o*f,c,f));return u}function ez(e,r){return e=eb(e),eM("string"==typeof r?new Promise((i,n)=>{eK(r).then(r=>{ez(e,r).then(i).catch(n)})}):ey.from(e).then(e=>{let i={};for(let n in r){let o=r[n],l=e.frames[0],u=2048*l.w,c=2048*l.h,f=o.frames?o.frames.map(e=>new E(l.x+(o.x+e.x)/u*l.w,l.y+(o.y+e.y)/c*l.h,e.w/u*l.w,e.h/c*l.h)):eH(o.sliceX||1,o.sliceY||1,l.x+o.x/u*l.w,l.y+o.y/c*l.h,o.width/u*l.w,o.height/c*l.h),g=new ey(e.tex,f,o.anims);eS.sprites.addLoaded(n,g),i[n]=g}return i}))}function eJ(e,r={}){let i=document.createElement("canvas"),n=e[0].width,o=e[0].height;i.width=n*e.length,i.height=o;let l=i.getContext("2d");e.forEach((e,r)=>{e instanceof ImageData?l.putImageData(e,r*n,0):l.drawImage(e,r*n,0)});let u=l.getImageData(0,0,e.length*n,o);return ey.fromImage(u,{...r,sliceX:e.length,sliceY:1})}function ti(e,r,i={sliceX:1,sliceY:1,anims:{}}){return Array.isArray(r=eb(r))?r.some(e=>"string"==typeof e)?eS.sprites.add(e,Promise.all(r.map(e=>"string"==typeof e?eQ(e):Promise.resolve(e))).then(e=>eJ(e,i))):eS.sprites.addLoaded(e,eJ(r,i)):"string"==typeof r?eS.sprites.add(e,ey.from(r,i)):eS.sprites.addLoaded(e,ey.fromImage(r,i))}function tn(e,r){return r=eb(r),eS.sprites.add(e,new Promise(async e=>{let i="string"==typeof r?await eK(r):r,n=await Promise.all(i.frames.map(eQ)),o=document.createElement("canvas");o.width=i.width,o.height=i.height*i.frames.length;let l=o.getContext("2d");n.forEach((e,r)=>{l.drawImage(e,0,r*i.height)}),e(await ti(null,o,{sliceY:i.frames.length,anims:i.anims}))}))}function ts(e,r,i){r=eb(r),i=eb(i),"string"!=typeof r||i||(i=eu(r)+".json");let n="string"==typeof i?eK(i):Promise.resolve(i);return eS.sprites.add(e,n.then(e=>{let i=e.meta.size,n=e.frames.map(e=>new E(e.frame.x/i.w,e.frame.y/i.h,e.frame.w/i.w,e.frame.h/i.h)),o={};for(let r of e.meta.frameTags)r.from===r.to?o[r.name]=r.from:o[r.name]={from:r.from,to:r.to,speed:10,loop:!0,pingpong:"pingpong"===r.direction};return ey.from(r,{frames:n,anims:o})}))}function to(e,r,i){return eS.shaders.addLoaded(e,tS(r,i))}function ta(e,r,i){r=eb(r),i=eb(i);let n=o(e=>e?eY(e):Promise.resolve(null),"resolveUrl"),l=Promise.all([n(r),n(i)]).then(([e,r])=>tS(e,r));return eS.shaders.add(e,l)}function th(e,r){return r=eb(r),eS.sounds.add(e,"string"==typeof r?ex.fromURL(r):ex.fromArrayBuffer(r))}function tl(e="bean"){return ti(e,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==")}function tu(e){return eS.sprites.get(e)}function td(e){return eS.sounds.get(e)}function tc(e){return eS.fonts.get(e)}function tf(e){return eS.bitmapFonts.get(e)}function tp(e){return eS.shaders.get(e)}function tg(e){return eS.custom.get(e)}function tm(e){if("string"==typeof e){let r=tu(e);if(r)return r;if(1>eP())return null;throw Error(`Sprite not found: ${e}`)}if(e instanceof ey)return eG.loaded(e);if(e instanceof eG)return e;throw Error(`Invalid sprite: ${e}`)}function tw(e){if("string"==typeof e){let r=td(e);if(r)return r;if(1>eP())return null;throw Error(`Sound not found: ${e}`)}if(e instanceof ex)return eG.loaded(e);if(e instanceof eG)return e;throw Error(`Invalid sound: ${e}`)}function tA(e){if(!e)return ev.defShader;if("string"==typeof e){let r=tp(e);if(r)return r.data??r;if(1>eP())return null;throw Error(`Shader not found: ${e}`)}return e instanceof eG&&e.data?e.data:e}function tV(r){if(!r)return tV(e.font??"monospace");if("string"==typeof r){let e=tf(r),i=tc(r);if(e)return e.data??e;if(i)return i.data??i;if(document.fonts.check(`64px ${r}`))return r;if(1>eP())return null;throw Error(`Font not found: ${r}`)}return r instanceof eG&&r.data?r.data:r}function tv(e){return void 0!==e&&(eE.masterNode.gain.value=e),eE.masterNode.gain.value}function ty(e,r={}){let i=eE.ctx,n=r.paused??!1,l=i.createBufferSource(),u=new ee,c=i.createGain(),f=r.seek??0,g=0,m=0,w=!1;l.loop=!!r.loop,l.detune.value=r.detune??0,l.playbackRate.value=r.speed??1,l.connect(c),l.onended=()=>{v()>=l.buffer?.duration&&u.trigger()},c.connect(eE.masterNode),c.gain.value=r.volume??1;let A=o(e=>{l.buffer=e.buf,n||(g=i.currentTime,l.start(0,f),w=!0)},"start"),V=tw(e);V instanceof eG&&V.onLoad(A);let v=o(()=>{if(!l.buffer)return 0;let e=n?m-g:i.currentTime-g,r=l.buffer.duration;return l.loop?e%r:Math.min(e,r)},"getTime"),y=o(e=>{let r=i.createBufferSource();return r.buffer=e.buffer,r.loop=e.loop,r.playbackRate.value=e.playbackRate.value,r.detune.value=e.detune.value,r.onended=e.onended,r.connect(c),r},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(M){if(n!==M){if(n=M,M)w&&(l.stop(),w=!1),m=i.currentTime;else{l=y(l);let e=m-g;l.start(0,e),w=!0,g=i.currentTime-e,m=0}}},get paused(){return n},play(e=0){this.seek(e),this.paused=!1},seek(e){l.buffer?.duration&&(e>l.buffer.duration||(n?(l=y(l),g=m-e):(l.stop(),l=y(l),g=i.currentTime-e,l.start(0,e),w=!0,m=0)))},set speed(M){l.playbackRate.value=M},get speed(){return l.playbackRate.value},set detune(M){l.detune.value=M},get detune(){return l.detune.value},set volume(M){c.gain.value=Math.max(M,0)},get volume(){return c.gain.value},set loop(M){l.loop=M},get loop(){return l.loop},duration:()=>l.buffer?.duration??0,time(){return v()%this.duration()},onEnd:e=>u.add(e),then(e){return this.onEnd(e)}}}function tx(e){return ty(eE.burpSnd,e)}function tE(e,r){return new ek(eV,e,r)}function tS(e=e8,r=e3){let i=e4.replace("{{user}}",e??e8),n=e6.replace("{{user}}",r??e3);try{return new eU(eV,i,n,e2.map(e=>e.name))}catch(o){let e=ef(o).match(/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/),r=Number(e.groups.line)-14,i=e.groups.msg.trim(),n=e.groups.type.toLowerCase();throw Error(`${n} shader line ${r}: ${i}`)}}function tb(e,r,i,n){let o=e.width/r,l={};for(let[e,u]of n.split("").entries())l[u]=new E(e%o*r,Math.floor(e/o)*i,r,i);return{tex:e,map:l,size:i}}function tR(e,r,i,n=ev.defTex,o=ev.defShader,l={}){let u=tA(o);if(!u||u instanceof eG)return;let c=ev.fixed||i?ev.transform:eR.cam.transform.mult(ev.transform),f=[];for(let r of e){let e=tF(c.multVec2(r.pos));f.push(e.x,e.y,r.uv.x,r.uv.y,r.color.r/255,r.color.g/255,r.color.b/255,r.opacity)}ev.renderer.push(eA.TRIANGLES,f,r,u,n,l)}function tM(){ev.renderer.flush()}function tP(){eA.clear(eA.COLOR_BUFFER_BIT),ev.frameBuffer.bind(),eA.clear(eA.COLOR_BUFFER_BIT),ev.bgColor||t$(()=>{tL({width:t3(),height:t7(),quad:new E(0,0,t3()/64,t7()/64),tex:ev.bgTex,fixed:!0})}),ev.renderer.numDraws=0,ev.fixed=!1,ev.transformStack.length=0,ev.transform=new R}function tT(e,r){ev.postShader=e,ev.postShaderUniform=r??null}function tB(){tM(),ev.lastDrawCalls=ev.renderer.numDraws,ev.frameBuffer.unbind(),eA.viewport(0,0,eA.drawingBufferWidth,eA.drawingBufferHeight);let e=ev.width,r=ev.height;ev.width=eA.drawingBufferWidth/X,ev.height=eA.drawingBufferHeight/X,tO({flipY:!0,tex:ev.frameBuffer.tex,pos:new A(ev.viewport.x,ev.viewport.y),width:ev.viewport.width,height:ev.viewport.height,shader:ev.postShader,uniform:"function"==typeof ev.postShaderUniform?ev.postShaderUniform():ev.postShaderUniform,fixed:!0}),tM(),ev.width=e,ev.height=r}function tF(e){return new A(e.x/t3()*2-1,-e.y/t7()*2+1)}function tC(e){ev.transform=e.clone()}function tD(...e){if(void 0===e[0])return;let r=V(...e);0===r.x&&0===r.y||ev.transform.translate(r)}function tI(...e){if(void 0===e[0])return;let r=V(...e);1===r.x&&1===r.y||ev.transform.scale(r)}function tk(e){e&&ev.transform.rotate(e)}function tU(){ev.transformStack.push(ev.transform.clone())}function tN(){ev.transformStack.length>0&&(ev.transform=ev.transformStack.pop())}function tL(e){if(void 0===e.width||void 0===e.height)throw Error('drawUVQuad() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let r=e.width,i=e.height,n=te(e.anchor||e$).scale(new A(r,i).scale(-.5)),o=e.quad||new E(0,0,1,1),l=e.color||y(255,255,255),u=e.opacity??1,c=e.tex?.1/e.tex.width:0,f=e.tex?.1/e.tex.height:0,g=o.x+c,m=o.y+f,w=o.w-2*c,V=o.h-2*f;tU(),tD(e.pos),tk(e.angle),tI(e.scale),tD(n),tR([{pos:new A(-r/2,i/2),uv:new A(e.flipX?g+w:g,e.flipY?m:m+V),color:l,opacity:u},{pos:new A(-r/2,-i/2),uv:new A(e.flipX?g+w:g,e.flipY?m+V:m),color:l,opacity:u},{pos:new A(r/2,-i/2),uv:new A(e.flipX?g:g+w,e.flipY?m+V:m),color:l,opacity:u},{pos:new A(r/2,i/2),uv:new A(e.flipX?g:g+w,e.flipY?m:m+V),color:l,opacity:u}],[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform),tN()}function tO(e){if(!e.tex)throw Error('drawTexture() requires property "tex".');let r=e.quad??new E(0,0,1,1),i=e.tex.width*r.w,n=e.tex.height*r.h,o=new A(1);if(e.tiled){let l=Math.ceil((e.width||i)/i),u=Math.ceil((e.height||n)/n),c=te(e.anchor||e$).add(new A(1,1)).scale(.5).scale(l*i,u*n);for(let f=0;f<l;f++)for(let l=0;l<u;l++)tL(Object.assign({},e,{pos:(e.pos||new A(0)).add(new A(i*f,n*l)).sub(c),scale:o.scale(e.scale||new A(1)),tex:e.tex,quad:r,width:i,height:n,anchor:"topleft"}))}else e.width&&e.height?(o.x=e.width/i,o.y=e.height/n):e.width?(o.x=e.width/i,o.y=o.x):e.height&&(o.y=e.height/n,o.x=o.y),tL(Object.assign({},e,{scale:o.scale(e.scale||new A(1)),tex:e.tex,quad:r,width:i,height:n}))}function tG(e){if(!e.sprite)throw Error('drawSprite() requires property "sprite"');let r=tm(e.sprite);if(!r||!r.data)return;let i=r.data.frames[e.frame??0];if(!i)throw Error(`Frame not found: ${e.frame??0}`);tO(Object.assign({},e,{tex:r.data.tex,quad:i.scale(e.quad??new E(0,0,1,1))}))}function tq(e,r,i,n,o,l=1){n=u(n%360),(o=u(o%360))<=n&&(o+=2*Math.PI);let c=[],f=Math.ceil((o-n)/u(8)*l),g=(o-n)/f;for(let l=n;l<o;l+=g)c.push(e.add(r*Math.cos(l),i*Math.sin(l)));return c.push(e.add(r*Math.cos(o),i*Math.sin(o))),c}function tH(e){if(void 0===e.width||void 0===e.height)throw Error('drawRect() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let r=e.width,i=e.height,n=te(e.anchor||e$).add(1,1).scale(new A(r,i).scale(-.5)),o=[new A(0,0),new A(r,0),new A(r,i),new A(0,i)];if(e.radius){let n=Math.min(Math.min(r,i)/2,e.radius);o=[new A(n,0),new A(r-n,0),...tq(new A(r-n,n),n,n,270,360),new A(r,n),new A(r,i-n),...tq(new A(r-n,i-n),n,n,0,90),new A(r-n,i),new A(n,i),...tq(new A(n,i-n),n,n,90,180),new A(0,i-n),new A(0,n),...tq(new A(n,n),n,n,180,270)]}tJ(Object.assign({},e,{offset:n,pts:o,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}function tK(e){let{p1:r,p2:i}=e;if(!r||!i)throw Error('drawLine() requires properties "p1" and "p2".');let n=e.width||1,o=i.sub(r).unit().normal().scale(.5*n);tR([r.sub(o),r.add(o),i.add(o),i.sub(o)].map(r=>({pos:new A(r.x,r.y),uv:new A(0),color:e.color??v.WHITE,opacity:e.opacity??1})),[0,1,3,1,2,3],e.fixed,ev.defTex,e.shader,e.uniform)}function tY(e){let r=e.pts;if(!r)throw Error('drawLines() requires property "pts".');if(!(r.length<2)){if(e.radius&&r.length>=3){let i=r[0].sdist(r[1]);for(let e=1;e<r.length-1;e++)i=Math.min(r[e].sdist(r[e+1]),i);e.radius,tK(Object.assign({},e,{p1:r[0],p2:r[1]}));for(let i=1;i<r.length-2;i++)tK(Object.assign({},e,{p1:r[i],p2:r[i+1]}));tK(Object.assign({},e,{p1:r[r.length-2],p2:r[r.length-1]}))}else for(let i=0;i<r.length-1;i++)tK(Object.assign({},e,{p1:r[i],p2:r[i+1]})),"none"!==e.join&&tQ(Object.assign({},e,{pos:r[i],radius:e.width/2}))}}function tj(e){if(!e.p1||!e.p2||!e.p3)throw Error('drawTriangle() requires properties "p1", "p2" and "p3".');return tJ(Object.assign({},e,{pts:[e.p1,e.p2,e.p3]}))}function tQ(e){if("number"!=typeof e.radius)throw Error('drawCircle() requires property "radius".');0!==e.radius&&tz(Object.assign({},e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}function tz(e){if(void 0===e.radiusX||void 0===e.radiusY)throw Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(0===e.radiusX||0===e.radiusY)return;let r=e.start??0,i=e.end??360,n=te(e.anchor??"center").scale(new A(-e.radiusX,-e.radiusY)),o=tq(n,e.radiusX,e.radiusY,r,i,e.resolution);o.unshift(n);let l=Object.assign({},e,{pts:o,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(o.length-1).fill(e.gradient[1])]}:{}});if(i-r>=360&&e.outline){!1!==e.fill&&tJ(Object.assign(l,{outline:null})),tJ(Object.assign(l,{pts:o.slice(1),fill:!1}));return}tJ(l)}function tJ(e){if(!e.pts)throw Error('drawPolygon() requires property "pts".');let r=e.pts.length;if(!(r<3)){if(tU(),tD(e.pos),tI(e.scale),tk(e.angle),tD(e.offset),!1!==e.fill){let i=e.color??v.WHITE,n=e.pts.map((r,n)=>({pos:new A(r.x,r.y),uv:new A(0,0),color:e.colors&&e.colors[n]?e.colors[n].mult(i):i,opacity:e.opacity??1})),o=[...Array(r-2).keys()].map(e=>[0,e+1,e+2]).flat();tR(n,e.indices??o,e.fixed,ev.defTex,e.shader,e.uniform)}e.outline&&tY({pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity}),tN()}}function tX(e,r,i){tM(),eA.clear(eA.STENCIL_BUFFER_BIT),eA.enable(eA.STENCIL_TEST),eA.stencilFunc(eA.NEVER,1,255),eA.stencilOp(eA.REPLACE,eA.REPLACE,eA.REPLACE),r(),tM(),eA.stencilFunc(i,1,255),eA.stencilOp(eA.KEEP,eA.KEEP,eA.KEEP),e(),tM(),eA.disable(eA.STENCIL_TEST)}function tW(e,r){tX(e,r,eA.EQUAL)}function tZ(e,r){tX(e,r,eA.NOTEQUAL)}function t_(){return(ev.viewport.width+ev.viewport.height)/(ev.width+ev.height)}function t$(e){tM();let r=ev.width,i=ev.height;ev.width=ev.viewport.width,ev.height=ev.viewport.height,e(),tM(),ev.width=r,ev.height=i}function t0(e,r){r.pos&&(e.pos=e.pos.add(r.pos)),r.scale&&(e.scale=e.scale.scale(V(r.scale))),r.angle&&(e.angle+=r.angle),r.color&&1===e.ch.length&&(e.color=e.color.mult(r.color)),r.opacity&&(e.opacity*=r.opacity)}o(eC,"loadFont"),o(eL,"loadBitmapFont"),o(eH,"slice"),o(ez,"loadSpriteAtlas"),o(eJ,"createSpriteSheet"),o(ti,"loadSprite"),o(tn,"loadPedit"),o(ts,"loadAseprite"),o(to,"loadShader"),o(ta,"loadShaderURL"),o(th,"loadSound"),o(tl,"loadBean"),o(tu,"getSprite"),o(td,"getSound"),o(tc,"getFont"),o(tf,"getBitmapFont"),o(tp,"getShader"),o(tg,"getAsset"),o(tm,"resolveSprite"),o(tw,"resolveSound"),o(tA,"resolveShader"),o(tV,"resolveFont"),o(tv,"volume"),o(ty,"play"),o(tx,"burp"),o(tE,"makeCanvas"),o(tS,"makeShader"),o(tb,"makeFont"),o(tR,"drawRaw"),o(tM,"flush"),o(tP,"frameStart"),o(tT,"usePostEffect"),o(tB,"frameEnd"),o(tF,"screen2ndc"),o(tC,"pushMatrix"),o(tD,"pushTranslate"),o(tI,"pushScale"),o(tk,"pushRotate"),o(tU,"pushTransform"),o(tN,"popTransform"),o(tL,"drawUVQuad"),o(tO,"drawTexture"),o(tG,"drawSprite"),o(tq,"getArcPts"),o(tH,"drawRect"),o(tK,"drawLine"),o(tY,"drawLines"),o(tj,"drawTriangle"),o(tQ,"drawCircle"),o(tz,"drawEllipse"),o(tJ,"drawPolygon"),o(tX,"drawStenciled"),o(tW,"drawMasked"),o(tZ,"drawSubtracted"),o(t_,"getViewportScale"),o(t$,"drawUnscaled"),o(t0,"applyCharTransform");let t1=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function t2(e){let r={},i=e.replace(t1,"$2"),n=0;for(let i of e.matchAll(t1)){let e=i.index-n;for(let n=0;n<i.groups.text.length;n++)r[n+e]=[i.groups.style];n+=i[0].length-i.groups.text.length}return{charStyleMap:r,text:i}}o(t2,"compileStyledText");let t5={};function t4(e){if(void 0===e.text)throw Error('formatText() requires property "text".');let r=tV(e.font);if(""===e.text||r instanceof eG||!r)return{width:0,height:0,chars:[],opt:e};let{charStyleMap:i,text:n}=t2(e.text+""),o=em(n);if(r instanceof eF||"string"==typeof r){let e=r instanceof eF?r.fontface.family:r,i=r instanceof eF?{outline:r.outline,filter:r.filter}:{outline:null,filter:e1},n=t5[e]??{font:{tex:new eI(eV,2048,2048,{filter:i.filter}),map:{},size:64},cursor:new A(0),outline:i.outline};for(let i of(t5[e]||(t5[e]=n),r=n.font,o))if(!n.font.map[i]){ei.clearRect(0,0,er.width,er.height),ei.font=`${r.size}px ${e}`,ei.textBaseline="top",ei.textAlign="left",ei.fillStyle="#ffffff";let o=Math.ceil(ei.measureText(i).width),l=r.size;n.outline&&(ei.lineJoin="round",ei.lineWidth=2*n.outline.width,ei.strokeStyle=n.outline.color.toHex(),ei.strokeText(i,n.outline.width,n.outline.width),o+=2*n.outline.width,l+=3*n.outline.width),ei.fillText(i,n.outline?.width??0,n.outline?.width??0);let u=ei.getImageData(0,0,o,l);if(n.cursor.x+o>2048&&(n.cursor.x=0,n.cursor.y+=l,n.cursor.y>2048))throw Error("Font atlas exceeds character limit");r.tex.update(u,n.cursor.x,n.cursor.y),r.map[i]=new E(n.cursor.x,n.cursor.y,o,l),n.cursor.x+=o}}let l=e.size||r.size,u=V(e.scale??1).scale(l/r.size),c=e.lineSpacing??0,f=e.letterSpacing??0,g=0,m=0,w=0,y=[],x=[],S=0,R=null,P=null;for(;S<o.length;){let i=o[S];if(i===`
`)w+=l+c,y.push({width:g-f,chars:x}),R=null,P=null,g=0,x=[];else{let n=r.map[i];if(n){let T=n.w*u.x;e.width&&g+T>e.width&&(w+=l+c,null!=R&&(S-=x.length-R,i=o[S],T=(n=r.map[i]).w*u.x,x=x.slice(0,R-1),g=P),R=null,P=null,y.push({width:g-f,chars:x}),g=0,x=[]),x.push({tex:r.tex,width:n.w,height:n.h,quad:new E(n.x/r.tex.width,n.y/r.tex.height,n.w/r.tex.width,n.h/r.tex.height),ch:i,pos:new A(g,w),opacity:e.opacity??1,color:e.color??v.WHITE,scale:V(u),angle:0})," "===i&&(R=x.length,P=g),g+=T,m=Math.max(m,g),g+=f}}S++}y.push({width:g-f,chars:x}),w+=l,e.width&&(m=e.width);let T=[];for(let n of y){let o=(m-n.width)*tt(e.align??"left");for(let l of n.chars){let n=r.map[l.ch],c=T.length;if(l.pos=l.pos.add(o,0).add(n.w*u.x*.5,n.h*u.y*.5),e.transform){let r="function"==typeof e.transform?e.transform(c,l.ch):e.transform;r&&t0(l,r)}if(i[c])for(let r of i[c]){let i=e.styles[r],n="function"==typeof i?i(c,l.ch):i;n&&t0(l,n)}T.push(l)}}return{width:m,height:w,chars:T,opt:e}}function t6(e){t8(t4(e))}function t8(e){tU(),tD(e.opt.pos),tk(e.opt.angle),tD(te(e.opt.anchor??"topleft").add(1,1).scale(e.width,e.height).scale(-.5)),e.chars.forEach(r=>{tL({tex:r.tex,width:r.width,height:r.height,pos:r.pos,scale:r.scale,angle:r.angle,color:r.color,opacity:r.opacity,quad:r.quad,anchor:"center",uniform:e.opt.uniform,shader:e.opt.shader,fixed:e.opt.fixed})}),tN()}function t3(){return ev.width}function t7(){return ev.height}function t9(e){return new A((e.x-ev.viewport.x)*t3()/ev.viewport.width,(e.y-ev.viewport.y)*t7()/ev.viewport.height)}function re(e){return new A(e.x*ev.viewport.width/ev.width,e.y*ev.viewport.height/ev.height)}function rt(){return t9(eg.mousePos())}o(t4,"formatText"),o(t6,"drawText"),o(t8,"drawFormattedText"),o(t3,"width"),o(t7,"height"),o(t9,"windowToContent"),o(re,"contentToView"),o(rt,"mousePos");let rr=!1,ri={inspect:!1,timeScale:1,showLog:!0,fps:()=>eg.fps(),numFrames:()=>eg.numFrames(),stepFrame:iR,drawCalls:()=>ev.lastDrawCalls,clearLog:()=>eR.logs=[],log:r=>{let i=e.logMax??8;eR.logs.unshift({msg:r,time:eg.time()}),eR.logs.length>i&&(eR.logs=eR.logs.slice(0,i))},error:e=>ri.log(Error(e.toString?e.toString():e)),curRecording:null,numObjects:()=>iA("*",{recursive:!0}).length,get paused(){return rr},set paused(t){rr=t,t?eE.ctx.suspend():eE.ctx.resume()}};function rn(){return eg.dt()*ri.timeScale}function rs(...e){return e.length>0&&(eR.cam.pos=V(...e)),eR.cam.pos?eR.cam.pos.clone():ia()}function ro(...e){return e.length>0&&(eR.cam.scale=V(...e)),eR.cam.scale.clone()}function ra(e){return void 0!==e&&(eR.cam.angle=e),eR.cam.angle}function rh(e=12){eR.cam.shake+=e}function rl(e){return eR.cam.transform.multVec2(e)}function ru(e){return eR.cam.transform.invert().multVec2(e)}function rd(e){let r=new R;return e.pos&&r.translate(e.pos),e.scale&&r.scale(e.scale),e.angle&&r.rotate(e.angle),e.parent?r.mult(e.parent.transform):r}function rc(e=[]){let r=new Map,i={},n=new et,l=[],u=null,c=!1,f={id:ec(),hidden:!1,transform:new R,children:[],parent:null,set paused(d){if(d!==c)for(let e of(c=d,l))e.paused=d},get paused(){return c},add(e=[]){let r=Array.isArray(e)?rc(e):e;if(r.parent)throw Error("Cannot add a game obj that already has a parent.");return r.parent=this,r.transform=rd(r),this.children.push(r),r.trigger("add",r),eR.events.trigger("add",r),r},readd(e){let r=this.children.indexOf(e);return -1!==r&&(this.children.splice(r,1),this.children.push(e)),e},remove(e){let r=this.children.indexOf(e);if(-1!==r){e.parent=null,this.children.splice(r,1);let i=o(e=>{e.trigger("destroy"),eR.events.trigger("destroy",e),e.children.forEach(e=>i(e))},"trigger");i(e)}},removeAll(e){if(e)this.get(e).forEach(e=>this.remove(e));else for(let e of[...this.children])this.remove(e)},update(){this.paused||(this.children.sort((e,r)=>(e.z??0)-(r.z??0)).forEach(e=>e.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&this.canvas.bind();let e=ev.fixed;this.fixed&&(ev.fixed=!0),tU(),tD(this.pos),tI(this.scale),tk(this.angle);let r=this.children.sort((e,r)=>(e.z??0)-(r.z??0));if(this.mask){let e={intersect:tW,subtract:tZ}[this.mask];if(!e)throw Error(`Invalid mask func: "${this.mask}"`);e(()=>{r.forEach(e=>e.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),r.forEach(e=>e.draw());tN(),ev.fixed=e,this.canvas&&this.canvas.unbind()},drawInspect(){this.hidden||(tU(),tD(this.pos),tI(this.scale),tk(this.angle),this.children.sort((e,r)=>(e.z??0)-(r.z??0)).forEach(e=>e.drawInspect()),this.trigger("drawInspect"),tN())},use(e){if(!e)return;if("string"==typeof e)return this.use({id:e});let n=[];for(let l in e.id&&(this.unuse(e.id),i[e.id]=[],n=i[e.id],r.set(e.id,e)),e){if(e7.has(l))continue;let r=Object.getOwnPropertyDescriptor(e,l);if("function"==typeof r.value&&(e[l]=e[l].bind(this)),r.set&&Object.defineProperty(e,l,{set:r.set.bind(this)}),r.get&&Object.defineProperty(e,l,{get:r.get.bind(this)}),e9.has(l)){let r="add"===l?()=>{u=o(e=>n.push(e),"onCurCompCleanup"),e[l](),u=null}:e[l];n.push(this.on(l,r).cancel)}else if(void 0===this[l])Object.defineProperty(this,l,{get:()=>e[l],set:r=>e[l]=r,configurable:!0,enumerable:!0}),n.push(()=>delete this[l]);else throw Error(`Duplicate component property: "${l}"`)}let l=o(()=>{if(e.require){for(let r of e.require)if(!this.c(r))throw Error(`Component "${e.id}" requires component "${r}"`)}},"checkDeps");e.destroy&&n.push(e.destroy.bind(this)),this.exists()?(l(),e.add&&(u=o(e=>n.push(e),"onCurCompCleanup"),e.add.call(this),u=null)):e.require&&n.push(this.on("add",l).cancel)},unuse(e){i[e]&&(i[e].forEach(e=>e()),delete i[e]),r.has(e)&&r.delete(e)},c:e=>r.get(e),get(e,r={}){let i=r.recursive?this.children.flatMap(o(function e(r){return[r,...r.children.flatMap(e)]},"recurse")):this.children;if(i=i.filter(r=>!e||r.is(e)),r.liveUpdate){let n=o(e=>r.recursive?this.isAncestorOf(e):e.parent===this,"isChild"),l=[];l.push(rm(r=>{n(r)&&r.is(e)&&i.push(r)})),l.push(rw(r=>{if(n(r)&&r.is(e)){let e=i.findIndex(e=>e.id===r.id);-1!==e&&i.splice(e,1)}})),this.onDestroy(()=>{for(let e of l)e.cancel()})}return i},isAncestorOf(e){return!!e.parent&&(e.parent===this||this.isAncestorOf(e.parent))},exists(){return eR.root.isAncestorOf(this)},is(e){if("*"===e)return!0;if(!Array.isArray(e))return null!=this.c(e);for(let r of e)if(!this.c(r))return!1;return!0},on(e,r){let i=n.on(e,r.bind(this));return u&&u(()=>i.cancel()),i},trigger(e,...r){n.trigger(e,...r),eR.objEvents.trigger(e,this,...r)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let e={};for(let[i,n]of r)e[i]=n.inspect?n.inspect():null;return e},onAdd(e){return this.on("add",e)},onUpdate(e){return this.on("update",e)},onDraw(e){return this.on("draw",e)},onDestroy(e){return this.on("destroy",e)},clearEvents(){n.clear()}};for(let e of["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick"])f[e]=(...r)=>{let i=eg[e](...r);return l.push(i),f.onDestroy(()=>i.cancel()),i};for(let r of e)f.use(r);return f}function rf(e,r,i){return eR.objEvents[e]||(eR.objEvents[e]=new _),eR.objEvents.on(e,(e,...n)=>{e.is(r)&&i(e,...n)})}o(rn,"dt"),o(rs,"camPos"),o(ro,"camScale"),o(ra,"camRot"),o(rh,"shake"),o(rl,"toScreen"),o(ru,"toWorld"),o(rd,"calcTransform"),o(rc,"make"),o(rf,"on");let rp=ed(e=>{let r=ig([{update:e}]);return{get paused(){return r.paused},set paused(s){r.paused=s},cancel:()=>r.destroy()}},(e,r)=>rf("update",e,r)),rg=ed(e=>{let r=ig([{draw:e}]);return{get paused(){return r.hidden},set paused(s){r.hidden=s},cancel:()=>r.destroy()}},(e,r)=>rf("draw",e,r)),rm=ed(e=>eR.events.on("add",e),(e,r)=>rf("add",e,r)),rw=ed(e=>eR.events.on("destroy",e),(e,r)=>rf("destroy",e,r));function rA(e,r,i){return rf("collide",e,(e,n,o)=>n.is(r)&&i(e,n,o))}function rV(e,r,i){return rf("collideUpdate",e,(e,n,o)=>n.is(r)&&i(e,n,o))}function rv(e,r,i){return rf("collideEnd",e,(e,n,o)=>n.is(r)&&i(e,n,o))}function ry(e,r){iA(e,{recursive:!0}).forEach(r),rm(e,r)}o(rA,"onCollide"),o(rV,"onCollideUpdate"),o(rv,"onCollideEnd"),o(ry,"forAllCurrentAndFuture");let rx=ed(e=>eg.onMousePress(e),(e,r)=>{let i=[];return ry(e,e=>{if(!e.area)throw Error("onClick() requires the object to have area() component");i.push(e.onClick(()=>r(e)))}),$.join(i)});function rE(e,r){let i=[];return ry(e,e=>{if(!e.area)throw Error("onHover() requires the object to have area() component");i.push(e.onHover(()=>r(e)))}),$.join(i)}function rS(e,r){let i=[];return ry(e,e=>{if(!e.area)throw Error("onHoverUpdate() requires the object to have area() component");i.push(e.onHoverUpdate(()=>r(e)))}),$.join(i)}function rb(e,r){let i=[];return ry(e,e=>{if(!e.area)throw Error("onHoverEnd() requires the object to have area() component");i.push(e.onHoverEnd(()=>r(e)))}),$.join(i)}function rR(e){eR.gravity=e}function rM(){return eR.gravity}function rP(...e){1===e.length||2===e.length?(ev.bgColor=y(e[0]),e[1]&&(ev.bgAlpha=e[1])):(3===e.length||4===e.length)&&(ev.bgColor=y(e[0],e[1],e[2]),e[3]&&(ev.bgAlpha=e[3])),eA.clearColor(ev.bgColor.r/255,ev.bgColor.g/255,ev.bgColor.b/255,ev.bgAlpha)}function rT(){return ev.bgColor.clone()}function rB(...e){return{id:"pos",pos:V(...e),moveBy(...e){this.pos=this.pos.add(V(...e))},move(...e){this.moveBy(V(...e).scale(rn()))},moveTo(...e){if("number"==typeof e[0]&&"number"==typeof e[1])return this.moveTo(V(e[0],e[1]),e[2]);let r=e[0],i=e[1];if(void 0===i){this.pos=V(r);return}let n=r.sub(this.pos);if(n.len()<=i*rn()){this.pos=V(r);return}this.move(n.unit().scale(i))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){let e=this.worldPos();return rq(this)?e:rl(e)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){tQ({color:y(255,0,0),radius:4/t_()})}}}function rF(...e){return 0===e.length?rF(1):{id:"scale",scale:V(...e),scaleTo(...e){this.scale=V(...e)},scaleBy(...e){this.scale.scale(V(...e))},inspect(){return`(${rI(this.scale.x,2)}, ${rI(this.scale.y,2)})`}}}function rC(e){return{id:"rotate",angle:e??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`${Math.round(this.angle)}`}}}function rD(...e){return{id:"color",color:y(...e),inspect(){return this.color.toString()}}}function rI(e,r){return Number(e.toFixed(r))}function rk(e){return{id:"opacity",opacity:e??1,inspect(){return`${rI(this.opacity,1)}`},fadeOut(e=1,r=eX.linear){return iy(this.opacity,0,e,e=>this.opacity=e,r)}}}function rU(e){if(!e)throw Error("Please define an anchor");return{id:"anchor",anchor:e,inspect(){return"string"==typeof this.anchor?this.anchor:this.anchor.toString()}}}function rN(e){return{id:"z",z:e,inspect(){return`${this.z}`}}}function rL(e,r){return{id:"follow",require:["pos"],follow:{obj:e,offset:r??V(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function rO(e,r){let i="number"==typeof e?A.fromAngle(e):e.unit();return{id:"move",require:["pos"],update(){this.move(i.scale(r))}}}function rG(e={}){let r=e.distance??200,i=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let e=this.screenPos(),i=new z(V(0),t3(),t7());return!G(i,e)&&i.sdistToPoint(e)>r*r},onExitScreen(e){return this.on("exitView",e)},onEnterScreen(e){return this.on("enterView",e)},update(){this.isOffScreen()?(i||(this.trigger("exitView"),i=!0),e.hide&&(this.hidden=!0),e.pause&&(this.paused=!0),e.destroy&&this.destroy()):(i&&(this.trigger("enterView"),i=!1),e.hide&&(this.hidden=!1),e.pause&&(this.paused=!1))}}}function rq(e){return!!e.fixed||!!e.parent&&rq(e.parent)}function rH(e={}){let r={},i=new Set;return{id:"area",collisionIgnore:e.collisionIgnore??[],add(){this.area.cursor&&this.onHover(()=>eg.setCursor(this.area.cursor)),this.onCollideUpdate((e,n)=>{r[e.id]||this.trigger("collide",e,n),r[e.id]=n,i.add(e.id)})},update(){for(let e in r)i.has(Number(e))||(this.trigger("collideEnd",r[e].target),delete r[e]);i.clear()},drawInspect(){let e=this.localArea();tU(),tI(this.area.scale),tD(this.area.offset);let r={outline:{width:4/t_(),color:y(0,0,255)},anchor:this.anchor,fill:!1,fixed:rq(this)};e instanceof z?tH({...r,pos:e.pos,width:e.width,height:e.height}):e instanceof W?tJ({...r,pts:e.pts}):e instanceof J&&tQ({...r,pos:e.center,radius:e.radius}),tN()},area:{shape:e.shape??null,scale:e.scale?V(e.scale):V(1),offset:e.offset??V(0),cursor:e.cursor??null},isClicked(){return eg.isMousePressed()&&this.isHovering()},isHovering(){let e=rq(this)?rt():ru(rt());return this.hasPoint(e)},checkCollision:e=>r[e.id]??null,getCollisions:()=>Object.values(r),isColliding:e=>!!r[e.id],isOverlapping(e){let i=r[e.id];return i&&i.hasOverlap()},onClick(e){let r=eg.onMousePress("left",()=>{this.isHovering()&&e()});return this.onDestroy(()=>r.cancel()),r},onHover(e){let r=!1;return this.onUpdate(()=>{r?r=this.isHovering():this.isHovering()&&(r=!0,e())})},onHoverUpdate(e){return this.onUpdate(()=>{this.isHovering()&&e()})},onHoverEnd(e){let r=!1;return this.onUpdate(()=>{r?this.isHovering()||(r=!1,e()):r=this.isHovering()})},onCollide(e,r){return"function"==typeof e&&void 0===r?this.on("collide",e):"string"==typeof e?this.onCollide((i,n)=>{i.is(e)&&r(i,n)}):void 0},onCollideUpdate(e,r){return"function"==typeof e&&void 0===r?this.on("collideUpdate",e):"string"==typeof e?this.on("collideUpdate",(i,n)=>i.is(e)&&r(i,n)):void 0},onCollideEnd(e,r){return"function"==typeof e&&void 0===r?this.on("collideEnd",e):"string"==typeof e?this.on("collideEnd",i=>i.is(e)&&r(i)):void 0},hasPoint(e){return j(this.worldArea(),e)},resolveCollision(e){let r=this.checkCollision(e);r&&!r.resolved&&(this.pos=this.pos.add(r.displacement),r.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let e=this.localArea();if(!(e instanceof W||e instanceof z))throw Error("Only support polygon and rect shapes for now");let r=this.transform.clone().scale(V(this.area.scale??1)).translate(this.area.offset);if(e instanceof z){let i=te(this.anchor||e$).add(1,1).scale(-.5).scale(e.width,e.height);r.translate(i)}return e.transform(r)},screenArea(){let e=this.worldArea();return rq(this)?e:e.transform(eR.cam.transform)}}}function rK(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,shader:e.shader,uniform:e.uniform}}function rY(e,r={}){let i=null,n=null,l=null,u=new ee;if(!e)throw Error("Please pass the resource name or data to sprite()");let c=o((e,r,i,n)=>{let o=V(1,1);return i&&n?(o.x=i/(e.width*r.w),o.y=n/(e.height*r.h)):i?(o.x=i/(e.width*r.w),o.y=o.x):n&&(o.y=n/(e.height*r.h),o.x=o.y),o},"calcTexScale");return{id:"sprite",width:0,height:0,frame:r.frame||0,quad:r.quad||new E(0,0,1,1),animSpeed:r.animSpeed??1,flipX:r.flipX??!1,flipY:r.flipY??!1,draw(){if(!i)return;let e=i.frames[this.frame??0];if(!e)throw Error(`Frame not found: ${this.frame??0}`);if(i.slice9){let{left:n,right:o,top:l,bottom:u}=i.slice9,c=i.tex.width*e.w,f=i.tex.height*e.h,g=this.width-n-o,m=this.height-l-u,w=n/c,A=o/c,V=1-w-A,v=l/f,y=u/f,x=1-v-y,E=[S(0,0,w,v),S(w,0,V,v),S(w+V,0,A,v),S(0,v,w,x),S(w,v,V,x),S(w+V,v,A,x),S(0,v+x,w,y),S(w,v+x,V,y),S(w+V,v+x,A,y),S(0,0,n,l),S(n,0,g,l),S(n+g,0,o,l),S(0,l,n,m),S(n,l,g,m),S(n+g,l,o,m),S(0,l+m,n,u),S(n,l+m,g,u),S(n+g,l+m,o,u)];for(let n=0;n<9;n++){let o=E[n],l=E[n+9];tO(Object.assign(rK(this),{pos:l.pos(),tex:i.tex,quad:e.scale(o),flipX:this.flipX,flipY:this.flipY,tiled:r.tiled,width:l.w,height:l.h}))}}else tO(Object.assign(rK(this),{tex:i.tex,quad:e.scale(this.quad??new E(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:r.tiled,width:this.width,height:this.height}))},add(){let n=o(e=>{let n=e.frames[0].clone();r.quad&&(n=n.scale(r.quad));let o=c(e.tex,n,r.width,r.height);this.width=e.tex.width*n.w*o.x,this.height=e.tex.height*n.h*o.y,r.anim&&this.play(r.anim),i=e,u.trigger(i)},"setSpriteData"),l=tm(e);l?l.onLoad(n):r9(()=>n(tm(e).data))},update(){if(!n)return;let e=i.anims[n.name];if("number"==typeof e){this.frame=e;return}if(0===e.speed)throw Error("Sprite anim speed cannot be 0");n.timer+=rn()*this.animSpeed,n.timer>=1/n.speed&&(n.timer=0,this.frame+=l,(this.frame<Math.min(e.from,e.to)||this.frame>Math.max(e.from,e.to))&&(n.loop?n.pingpong?(this.frame-=l,l*=-1,this.frame+=l):this.frame=e.from:(this.frame=e.to,n.onEnd(),this.stop())))},play(e,r={}){if(!i){u.add(()=>this.play(e,r));return}let o=i.anims[e];if(void 0===o)throw Error(`Anim not found: ${e}`);n&&this.stop(),n="number"==typeof o?{name:e,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:e,timer:0,loop:r.loop??o.loop??!1,pingpong:r.pingpong??o.pingpong??!1,speed:r.speed??o.speed??10,onEnd:r.onEnd??(()=>{})},l="number"==typeof o?null:o.from<o.to?1:-1,this.frame="number"==typeof o?o:o.from,this.trigger("animStart",e)},stop(){if(!n)return;let e=n.name;n=null,this.trigger("animEnd",e)},numFrames:()=>i?.frames.length??0,curAnim:()=>n?.name,onAnimEnd(e){return this.on("animEnd",e)},onAnimStart(e){return this.on("animStart",e)},renderArea(){return new z(V(0),this.width,this.height)},inspect(){if("string"==typeof e)return`"${e}"`}}}function rj(e,r={}){function i(e){let i=t4(Object.assign(rK(e),{text:e.text+"",size:e.textSize,font:e.font,width:r.width&&e.width,align:e.align,letterSpacing:e.letterSpacing,lineSpacing:e.lineSpacing,transform:e.textTransform,styles:e.textStyles}));return r.width||(e.width=i.width/(e.scale?.x||1)),e.height=i.height/(e.scale?.y||1),i}o(i,"update");let n={id:"text",set text(a){e=a,i(this)},get text(){return e},textSize:r.size??36,font:r.font,width:r.width??0,height:0,align:r.align,lineSpacing:r.lineSpacing,letterSpacing:r.letterSpacing,textTransform:r.transform,textStyles:r.styles,add(){r9(()=>i(this))},draw(){t8(i(this))},renderArea(){return new z(V(0),this.width,this.height)}};return i(n),n}function rQ(e,r={}){if(e.length<3)throw Error(`Polygon's need more than two points, ${e.length} points provided`);return{id:"polygon",pts:e,colors:r.colors,radius:r.radius,draw(){tJ(Object.assign(rK(this),{pts:this.pts,colors:this.colors,radius:this.radius,fill:r.fill}))},renderArea(){return new W(this.pts)},inspect(){return this.pts.map(e=>`[${e.x},${e.y}]`).join(",")}}}function rz(e,r,i={}){return{id:"rect",width:e,height:r,radius:i.radius||0,draw(){tH(Object.assign(rK(this),{width:this.width,height:this.height,radius:this.radius,fill:i.fill}))},renderArea(){return new z(V(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function rJ(e,r){return{id:"rect",width:e,height:r,draw(){tL(Object.assign(rK(this),{width:this.width,height:this.height}))},renderArea(){return new z(V(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function rX(e,r={}){return{id:"circle",radius:e,draw(){tQ(Object.assign(rK(this),{radius:this.radius,fill:r.fill}))},renderArea(){return new z(new A(this.anchor?0:-this.radius),2*this.radius,2*this.radius)},inspect(){return`${Math.ceil(this.radius)}`}}}function rW(e=1,r=y(0,0,0)){return{id:"outline",outline:{width:e,color:r}}}function rZ(){return{id:"timer",wait(e,r){let i=[];r&&i.push(r);let n=0,o=this.onUpdate(()=>{(n+=rn())>=e&&(i.forEach(e=>e()),o.cancel())});return{get paused(){return o.paused},set paused(h){o.paused=h},cancel:o.cancel,onEnd(e){i.push(e)},then(e){return this.onEnd(e),this}}},loop(e,r){let i=null,n=o(()=>{i=this.wait(e,n),r()},"newAction");return i=this.wait(0,n),{get paused(){return i.paused},set paused(a){i.paused=a},cancel:()=>i.cancel()}},tween(e,r,i,n,o=eX.linear){let l=0,u=[],c=this.onUpdate(()=>{let f=Math.min((l+=rn())/i,1);n(g(e,r,o(f))),1===f&&(c.cancel(),n(r),u.forEach(e=>e()))});return{get paused(){return c.paused},set paused(p){c.paused=p},onEnd(e){u.push(e)},then(e){return this.onEnd(e),this},cancel(){c.cancel()},finish(){c.cancel(),n(r),u.forEach(e=>e())}}}}}function r_(e={}){let r=null,i=null,n=!1;return{id:"body",require:["pos","area"],vel:new A(0),jumpForce:e.jumpForce??640,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(0===this.mass)throw Error("Can't set body mass to 0");this.onCollideUpdate((e,r)=>{if(e.is("body")&&!r.resolved&&(this.trigger("beforePhysicsResolve",r),e.trigger("beforePhysicsResolve",r.reverse()),!r.resolved&&!(this.isStatic&&e.isStatic))){if(this.isStatic||e.isStatic){let i=!this.isStatic&&e.isStatic?r:r.reverse();i.source.pos=i.source.pos.add(i.displacement),i.source.transform=rd(i.source)}else{let i=this.mass+e.mass;this.pos=this.pos.add(r.displacement.scale(e.mass/i)),e.pos=e.pos.add(r.displacement.scale(-this.mass/i)),this.transform=rd(this),e.transform=rd(e)}r.resolved=!0,this.trigger("physicsResolve",r),e.trigger("physicsResolve",r.reverse())}}),this.onPhysicsResolve(e=>{eR.gravity&&(e.isBottom()&&this.isFalling()?(this.vel.y=0,r=e.target,i=e.target.pos,n?n=!1:this.trigger("ground",r)):e.isTop()&&this.isJumping()&&(this.vel.y=0,this.trigger("headbutt",e.target)))})},update(){if(!eR.gravity||this.isStatic)return;if(n&&(r=null,i=null,this.trigger("fallOff"),n=!1),r){if(this.isColliding(r)&&r.exists()&&r.is("body")){r.pos.eq(i)||!1===e.stickToPlatform||this.moveBy(r.pos.sub(i)),i=r.pos;return}n=!0}let o=this.vel.y;this.vel.y+=eR.gravity*this.gravityScale*rn(),this.vel.y=Math.min(this.vel.y,e.maxVelocity??65536),o<0&&this.vel.y>=0&&this.trigger("fall"),this.move(this.vel)},onPhysicsResolve(e){return this.on("physicsResolve",e)},onBeforePhysicsResolve(e){return this.on("beforePhysicsResolve",e)},curPlatform:()=>r,isGrounded:()=>null!==r,isFalling(){return this.vel.y>0},isJumping(){return this.vel.y<0},jump(e){r=null,i=null,this.vel.y=-e||-this.jumpForce},onGround(e){return this.on("ground",e)},onFall(e){return this.on("fall",e)},onFallOff(e){return this.on("fallOff",e)},onHeadbutt(e){return this.on("headbutt",e)}}}function r$(e=2){let r=e;return{id:"doubleJump",require:["body"],numJumps:e,add(){this.onGround(()=>{r=this.numJumps})},doubleJump(e){r<=0||(r<this.numJumps&&this.trigger("doubleJump"),r--,this.jump(e))},onDoubleJump(e){return this.on("doubleJump",e)},inspect:()=>`${r}`}}function r0(e,r){return{id:"shader",shader:e,..."function"==typeof r?{uniform:r(),update(){this.uniform=r()}}:{uniform:r}}}function r1(){return{id:"fixed",fixed:!0}}function r2(e){return{id:"stay",stay:!0,scenesToStay:e}}function r5(e,r){if(null==e)throw Error("health() requires the initial amount of hp");return{id:"health",hurt(r=1){this.setHP(e-r),this.trigger("hurt",r)},heal(r=1){let i=e;this.setHP(e+r),this.trigger("heal",e-i)},hp:()=>e,maxHP:()=>r??null,setMaxHP(e){r=e},setHP(i){(e=r?Math.min(r,i):i)<=0&&this.trigger("death")},onHurt(e){return this.on("hurt",e)},onHeal(e){return this.on("heal",e)},onDeath(e){return this.on("death",e)},inspect:()=>`${e}`}}function r4(e,r={}){if(null==e)throw Error("lifespan() requires time");let i=r.fade??0;return{id:"lifespan",async add(){await iV(e),i>0&&this.opacity&&await iy(this.opacity,0,i,e=>this.opacity=e,eX.linear),this.destroy()}}}function r6(e,r,i){if(!e)throw Error("state() requires an initial state");let n={};function l(e){n[e]||(n[e]={enter:new ee,end:new ee,update:new ee,draw:new ee})}function u(e,r,i){return l(r),n[r][e].add(i)}function c(e,r,...i){l(r),n[r][e].trigger(...i)}o(l,"initStateEvents"),o(u,"on"),o(c,"trigger");let f=!1;return{id:"state",state:e,enterState(e,...n){if(f=!0,r&&!r.includes(e))throw Error(`State not found: ${e}`);let o=this.state;if(i){if(!i?.[o])return;let r="string"==typeof i[o]?[i[o]]:i[o];if(!r.includes(e))throw Error(`Cannot transition state from "${o}" to "${e}". Available transitions: ${r.map(e=>`"${e}"`).join(", ")}`)}c("end",o,...n),this.state=e,c("enter",e,...n),c("enter",`${o} -> ${e}`,...n)},onStateTransition:(e,r,i)=>u("enter",`${e} -> ${r}`,i),onStateEnter:(e,r)=>u("enter",e,r),onStateUpdate:(e,r)=>u("update",e,r),onStateDraw:(e,r)=>u("draw",e,r),onStateEnd:(e,r)=>u("end",e,r),update(){f||(c("enter",e),f=!0),c("update",this.state)},draw(){c("draw",this.state)},inspect(){return this.state}}}function r8(e=1){let r=0,i=!1;return{require:["opacity"],add(){this.opacity=0},update(){i||(r+=rn(),this.opacity=m(r,0,e,0,1),r>=e&&(this.opacity=1,i=!0))}}}function r3(e="intersect"){return{id:"mask",mask:e}}function r7(e){return{add(){this.canvas=e}}}function r9(e){eS.loaded?e():eR.events.on("load",e)}function ie(e,r){eR.scenes[e]=r}function it(e,...r){if(!eR.scenes[e])throw Error(`Scene not found: ${e}`);eR.events.onOnce("frameEnd",()=>{eR.events.trigger("sceneLeave",e),eg.events.clear(),eR.events.clear(),eR.objEvents.clear(),[...eR.root.children].forEach(r=>{r.stay&&(!r.scenesToStay||r.scenesToStay.includes(e))||eR.root.remove(r)}),eR.root.clearEvents(),iq(),eR.cam={pos:null,scale:V(1),angle:0,shake:0,transform:new R},eR.scenes[e](...r)})}function ir(e){return eR.events.on("sceneLeave",e)}function ii(e,r){try{return JSON.parse(window.localStorage[e])}catch{return r?(is(e,r),r):null}}function is(e,r){window.localStorage[e]=JSON.stringify(r)}function io(r,...i){let n=r(iH),o;for(let r in o="function"==typeof n?n(...i)(iH):n)iH[r]=o[r],!1!==e.global&&(window[r]=o[r]);return iH}function ia(){return V(t3()/2,t7()/2)}function ih(e={}){let r=V(0),i=e.isObstacle??!1,n=e.cost??0,l=e.edges??[],u=o(()=>{let e={left:1,top:2,right:4,bottom:8};return l.map(r=>e[r]||0).reduce((e,r)=>e|r,0)},"getEdgeMask"),c=u();return{id:"tile",tilePosOffset:e.offset??V(0),set tilePos(b){let e=this.getLevel();r=b.clone(),this.pos=V(this.tilePos.x*e.tileWidth(),this.tilePos.y*e.tileHeight()).add(this.tilePosOffset)},get tilePos(){return r},set isObstacle(b){i!==b&&(i=b,this.getLevel().invalidateNavigationMap())},get isObstacle(){return i},set cost(b){n!==b&&(n=b,this.getLevel().invalidateNavigationMap())},get cost(){return n},set edges(b){l=b,c=u(),this.getLevel().invalidateNavigationMap()},get edges(){return l},get edgeMask(){return c},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(V(-1,0))},moveRight(){this.tilePos=this.tilePos.add(V(1,0))},moveUp(){this.tilePos=this.tilePos.add(V(0,-1))},moveDown(){this.tilePos=this.tilePos.add(V(0,1))}}}function il(e,r){if(!r.tileWidth||!r.tileHeight)throw Error("Must provide tileWidth and tileHeight.");let i=ig([rB(r.pos??V(0))]),n=e.length,l=0,u=null,c=null,f=null,g=null,m=o(e=>e.x+e.y*l,"tile2Hash"),w=o(e=>V(Math.floor(e%l),Math.floor(e/l)),"hash2Tile"),A=o(()=>{for(let e of(u=[],i.children))v(e)},"createSpatialMap"),v=o(e=>{let r=m(e.tilePos);u[r]?u[r].push(e):u[r]=[e]},"insertIntoSpatialMap"),y=o(e=>{let r=m(e.tilePos);if(u[r]){let i=u[r].indexOf(e);i>=0&&u[r].splice(i,1)}},"removeFromSpatialMap"),x=o(()=>{let e=!1;for(let r of i.children){let n=i.pos2Tile(r.pos);(r.tilePos.x!=n.x||r.tilePos.y!=n.y)&&(e=!0,y(r),r.tilePos.x=n.x,r.tilePos.y=n.y,v(r))}e&&i.trigger("spatial_map_changed")},"updateSpatialMap"),E=o(()=>{let e=i.getSpatialMap(),r=i.numRows()*i.numColumns();c?c.length=r:c=Array(r),c.fill(1,0,r);for(let r=0;r<e.length;r++){let i=e[r];if(i){let e=0;for(let r of i)if(r.isObstacle){e=1/0;break}else e+=r.cost;c[r]=e||1}}},"createCostMap"),S=o(()=>{let e=i.getSpatialMap(),r=i.numRows()*i.numColumns();f?f.length=r:f=Array(r),f.fill(15,0,r);for(let r=0;r<e.length;r++){let i=e[r];if(i){let e=i.length,n=15;for(let r=0;r<e;r++)n|=i[r].edgeMask;f[r]=n}}},"createEdgeMap"),R=o(()=>{let e=i.numRows()*i.numColumns(),r=o((e,r)=>{let i=[];for(i.push(e);i.length>0;)B(i.pop()).forEach(e=>{g[e]<0&&(g[e]=r,i.push(e))})},"traverse");g?g.length=e:g=Array(e),g.fill(-1,0,e);let n=0;for(let e=0;e<c.length;e++){if(g[e]>=0){n++;continue}r(e,n),n++}},"createConnectivityMap"),P=o((e,r)=>c[r],"getCost"),T=o((e,r)=>{let i=w(e),n=w(r);return i.dist(n)},"getHeuristic"),B=o((e,r)=>{let i=[],o=Math.floor(e%l),u=o>0&&1&f[e]&&c[e-1]!==1/0,g=e>=l&&2&f[e]&&c[e-l]!==1/0,m=o<l-1&&4&f[e]&&c[e+1]!==1/0,w=e<l*n-l-1&&8&f[e]&&c[e+l]!==1/0;return r?(u&&(g&&i.push(e-l-1),i.push(e-1),w&&i.push(e+l-1)),g&&i.push(e-l),m&&(g&&i.push(e-l+1),i.push(e+1),w&&i.push(e+l+1))):(u&&i.push(e-1),g&&i.push(e-l),m&&i.push(e+1)),w&&i.push(e+l),i},"getNeighbours");return i.use({id:"level",tileWidth:()=>r.tileWidth,tileHeight:()=>r.tileHeight,spawn(e,...n){let o=V(...n),l=(()=>{if("string"==typeof e){if(r.tiles[e]){if("function"!=typeof r.tiles[e])throw Error("Level symbol def must be a function returning a component list");return r.tiles[e](o)}if(r.wildcardTile)return r.wildcardTile(e,o)}else{if(Array.isArray(e))return e;throw Error("Expected a symbol or a component list")}})();if(!l)return null;let c=!1,f=!1;for(let e of l)"tile"===e.id&&(f=!0),"pos"===e.id&&(c=!0);c||l.push(rB()),f||l.push(ih());let g=i.add(l);return c&&(g.tilePosOffset=g.pos.clone()),g.tilePos=o,u&&(v(g),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),g},numColumns:()=>l,numRows:()=>n,levelWidth(){return l*this.tileWidth()},levelHeight(){return n*this.tileHeight()},tile2Pos(...e){return V(...e).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...e){let r=V(...e);return V(Math.floor(r.x/this.tileWidth()),Math.floor(r.y/this.tileHeight()))},getSpatialMap:()=>(u||A(),u),onSpatialMapChanged(e){return this.on("spatial_map_changed",e)},onNavigationMapInvalid(e){return this.on("navigation_map_invalid",e)},getAt:e=>(u||A(),u[m(e)]||[]),update(){u&&x()},invalidateNavigationMap(){c=null,f=null,g=null},onNavigationMapChanged(e){return this.on("navigation_map_changed",e)},getTilePath(e,r,i={}){if(c||E(),f||S(),g||R(),e.x<0||e.x>=l||e.y<0||e.y>=n||r.x<0||r.x>=l||r.y<0||r.y>=n)return null;let o=m(e),u=m(r);if(c[u]===1/0)return null;if(o===u)return[];if(-1!=g[o]&&g[o]!==g[u])return null;let A=new ep((e,r)=>e.cost<r.cost);A.insert({cost:0,node:o});let V=new Map;V.set(o,o);let v=new Map;for(v.set(o,0);0!==A.length;){let e=A.remove()?.node;if(e===u)break;for(let r of B(e,i.allowDiagonals)){let i=(v.get(e)||0)+P(e,r)+T(r,u);(!v.has(r)||i<v.get(r))&&(v.set(r,i),A.insert({cost:i,node:r}),V.set(r,e))}}let y=[],x=u,F=w(x);for(y.push(F);x!==o;){let e=w(x=V.get(x));y.push(e)}return y.reverse()},getPath(e,r,i={}){let n=this.tileWidth(),o=this.tileHeight(),l=this.getTilePath(this.pos2Tile(e),this.pos2Tile(r),i);return l?[e,...l.slice(1,-1).map(e=>e.scale(n,o).add(n/2,o/2)),r]:null}}),i.onNavigationMapInvalid(()=>{i.invalidateNavigationMap(),i.trigger("navigation_map_changed")}),e.forEach((e,r)=>{let n=e.split("");l=Math.max(n.length,l),n.forEach((e,n)=>{i.spawn(e,V(n,r))})}),i}function iu(e={}){let r=null,i=null,n=null,o=null;return{id:"agent",require:["pos","tile"],agentSpeed:e.speed??100,allowDiagonals:e.allowDiagonals??!0,getDistanceToTarget(){return r?this.pos.dist(r):0},getNextLocation:()=>i&&n?i[n]:null,getPath:()=>i?i.slice():null,getTarget:()=>r,isNavigationFinished:()=>!i||null===n,isTargetReachable:()=>null!==i,isTargetReached(){return!r||this.pos.eq(r)},setTarget(e){r=e,n=(i=this.getLevel().getPath(this.pos,r,{allowDiagonals:this.allowDiagonals}))?0:null,i?(o||(o=this.getLevel().onNavigationMapChanged(()=>{i&&null!==n&&(n=(i=this.getLevel().getPath(this.pos,r,{allowDiagonals:this.allowDiagonals}))?0:null,i?this.trigger("navigation-next",this,i[n]):this.trigger("navigation-ended",this))}),this.onDestroy(()=>o.cancel())),this.trigger("navigation-started",this),this.trigger("navigation-next",this,i[n])):this.trigger("navigation-ended",this)},update(){if(i&&null!==n){if(2>this.pos.sdist(i[n])){if(n===i.length-1){this.pos=r.clone(),n=null,this.trigger("navigation-ended",this),this.trigger("target-reached",this);return}n++,this.trigger("navigation-next",this,i[n])}this.moveTo(i[n],this.agentSpeed)}},onNavigationStarted(e){return this.on("navigation-started",e)},onNavigationNext(e){return this.on("navigation-next",e)},onNavigationEnded(e){return this.on("navigation-ended",e)},onTargetReached(e){return this.on("target-reached",e)},inspect:()=>JSON.stringify({target:JSON.stringify(r),path:JSON.stringify(i)})}}function id(e){let r=eg.canvas.captureStream(e),i=eE.ctx.createMediaStreamDestination();eE.masterNode.connect(i);let n=new MediaRecorder(r),o=[];return n.ondataavailable=e=>{e.data.size>0&&o.push(e.data)},n.onerror=()=>{eE.masterNode.disconnect(i),r.getTracks().forEach(e=>e.stop())},n.start(),{resume(){n.resume()},pause(){n.pause()},stop:()=>(n.stop(),eE.masterNode.disconnect(i),r.getTracks().forEach(e=>e.stop()),new Promise(e=>{n.onstop=()=>{e(new Blob(o,{type:"video/mp4"}))}})),download(e="kaboom.mp4"){this.stop().then(r=>eh(e,r))}}}function ic(){return document.activeElement===eg.canvas}function ip(e){e.destroy()}o(rE,"onHover"),o(rS,"onHoverUpdate"),o(rb,"onHoverEnd"),o(rR,"setGravity"),o(rM,"getGravity"),o(rP,"setBackground"),o(rT,"getBackground"),o(rB,"pos"),o(rF,"scale"),o(rC,"rotate"),o(rD,"color"),o(rI,"toFixed"),o(rk,"opacity"),o(rU,"anchor"),o(rN,"z"),o(rL,"follow"),o(rO,"move"),o(rG,"offscreen"),o(rq,"isFixed"),o(rH,"area"),o(rK,"getRenderProps"),o(rY,"sprite"),o(rj,"text"),o(rQ,"polygon"),o(rz,"rect"),o(rJ,"uvquad"),o(rX,"circle"),o(rW,"outline"),o(rZ,"timer"),o(r_,"body"),o(r$,"doubleJump"),o(r0,"shader"),o(r1,"fixed"),o(r2,"stay"),o(r5,"health"),o(r4,"lifespan"),o(r6,"state"),o(r8,"fadeIn"),o(r3,"mask"),o(r7,"drawon"),o(r9,"onLoad"),o(ie,"scene"),o(it,"go"),o(ir,"onSceneLeave"),o(ii,"getData"),o(is,"setData"),o(io,"plug"),o(ia,"center"),(r=i||={})[r.None=0]="None",r[r.Left=1]="Left",r[r.Top=2]="Top",r[r.LeftTop=3]="LeftTop",r[r.Right=4]="Right",r[r.Horizontal=5]="Horizontal",r[r.RightTop=6]="RightTop",r[r.HorizontalTop=7]="HorizontalTop",r[r.Bottom=8]="Bottom",r[r.LeftBottom=9]="LeftBottom",r[r.Vertical=10]="Vertical",r[r.LeftVertical=11]="LeftVertical",r[r.RightBottom=12]="RightBottom",r[r.HorizontalBottom=13]="HorizontalBottom",r[r.RightVertical=14]="RightVertical",r[r.All=15]="All",o(ih,"tile"),o(il,"addLevel"),o(iu,"agent"),o(id,"record"),o(ic,"isFocused"),o(ip,"destroy");let ig=eR.root.add.bind(eR.root),im=eR.root.readd.bind(eR.root),iw=eR.root.removeAll.bind(eR.root),iA=eR.root.get.bind(eR.root),iV=eR.root.wait.bind(eR.root),iv=eR.root.loop.bind(eR.root),iy=eR.root.tween.bind(eR.root);function ix(e=2,r=1){let i=0;return{require:["scale"],update(){let n=Math.sin(i*e)*r;n<0&&this.destroy(),this.scale=V(n),i+=rn()}}}o(ix,"boom");let iE=ti(null,"data:image/png;base64,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"),iS=ti(null,"data:image/png;base64,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");function ib(e,r={}){let i=ig([rB(e),r2()]),n=5*(r.speed||1),o=r.scale||1;i.add([rY(iS),rF(0),rU("center"),ix(n,o),...r.comps??[]]);let l=i.add([rY(iE),rF(0),rU("center"),rZ(),...r.comps??[]]);return l.wait(.4/n,()=>l.use(ix(n,o))),l.onDestroy(()=>i.destroy()),i}function iR(){eR.root.update()}o(ib,"addKaboom"),o(iR,"updateFrame");class iM{static{o(this,"Collision")}constructor(e,r,i,n=!1){this.resolved=!1,this.source=e,this.target=r,this.displacement=i,this.resolved=n}reverse(){return new iM(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}}function iP(){let r={},i=e.hashGridSize||64,n=new R,l=[];function u(e){if(l.push(n.clone()),e.pos&&n.translate(e.pos),e.scale&&n.scale(e.scale),e.angle&&n.rotate(e.angle),e.transform=n.clone(),e.c("area")&&!e.paused){let n=e.worldArea().bbox(),o=Math.floor(n.pos.x/i),l=Math.floor(n.pos.y/i),u=Math.ceil((n.pos.x+n.width)/i),c=Math.ceil((n.pos.y+n.height)/i),f=new Set;for(let i=o;i<=u;i++)for(let n=l;n<=c;n++)if(r[i]){if(r[i][n]){let o=r[i][n];e:for(let r of o){if(r.paused||!r.exists()||f.has(r.id))continue;for(let i of e.collisionIgnore)if(r.is(i))continue e;for(let i of r.collisionIgnore)if(e.is(i))continue e;let i=Z(e.worldArea(),r.worldArea());if(i){let n=new iM(e,r,i);e.trigger("collideUpdate",r,n);let o=n.reverse();o.resolved=n.resolved,r.trigger("collideUpdate",e,o)}f.add(r.id)}o.push(e)}else r[i][n]=[e]}else r[i]={},r[i][n]=[e]}e.children.forEach(u),n=l.pop()}o(u,"checkObj"),u(eR.root)}function iT(){let e=eR.cam,r=A.fromAngle(C(0,360)).scale(e.shake);e.shake=g(e.shake,0,5*rn()),e.transform=new R().translate(ia()).scale(e.scale).rotate(e.angle).translate((e.pos??ia()).scale(-1).add(r)),eR.root.draw(),tM()}function iB(){let e=eP();eR.events.numListeners("loading")>0?eR.events.trigger("loading",e):t$(()=>{let r=t3()/2,i=V(t3()/2,t7()/2).sub(V(r/2,12));tH({pos:V(0),width:t3(),height:t7(),color:y(0,0,0)}),tH({pos:i,width:r,height:24,fill:!1,outline:{width:4}}),tH({pos:i,width:r*e,height:24})})}function iF(e,r){t$(()=>{let i=V(8);tU(),tD(e);let n=t4({text:r,font:e0,size:16,pos:i,color:y(255,255,255),fixed:!0}),o=n.width+2*i.x,l=n.height+2*i.x;e.x+o>=t3()&&tD(V(-o,0)),e.y+l>=t7()&&tD(V(0,-l)),tH({width:o,height:l,color:y(0,0,0),radius:4,opacity:.8,fixed:!0}),t8(n),tN()})}function iC(){if(ri.inspect){let e=null;for(let r of eR.root.get("*",{recursive:!0}))if(r.c("area")&&r.isHovering()){e=r;break}if(eR.root.drawInspect(),e){let r=[],i=e.inspect();for(let e in i)i[e]?r.push(`${e}: ${i[e]}`):r.push(`${e}`);iF(re(rt()),r.join(`
`))}iF(V(8),`FPS: ${ri.fps()}`)}ri.paused&&t$(()=>{tU(),tD(t3(),0),tD(-8,8),tH({width:32,height:32,anchor:"topright",color:y(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)tH({width:4,height:19.2,anchor:"center",pos:V(-32/3*e,16),color:y(255,255,255),radius:2,fixed:!0});tN()}),1!==ri.timeScale&&t$(()=>{tU(),tD(t3(),t7()),tD(-8,-8);let e=t4({text:ri.timeScale.toFixed(1),font:e0,size:16,color:y(255,255,255),pos:V(-8),anchor:"botright",fixed:!0});tH({width:e.width+16+32,height:e.height+16,anchor:"botright",color:y(0,0,0),opacity:.8,radius:4,fixed:!0});for(let r=0;r<2;r++){let i=ri.timeScale<1;tj({p1:V(-e.width-8*(i?2:3.5),-8),p2:V(-e.width-8*(i?2:3.5),-8-e.height),p3:V(-e.width-8*(i?3.5:2),-8-e.height/2),pos:V(-(8*r)+(i?-4:0),0),color:y(255,255,255),fixed:!0})}t8(e),tN()}),ri.curRecording&&t$(()=>{tU(),tD(0,t7()),tD(24,-24),tQ({radius:12,color:y(255,0,0),opacity:P(0,1,4*eg.time()),fixed:!0}),tN()}),ri.showLog&&eR.logs.length>0&&t$(()=>{tU(),tD(0,t7()),tD(8,-8);let r=[];for(let e of eR.logs){let i="",n=e.msg instanceof Error?"error":"info";i+=`[time]${e.time.toFixed(2)}[/time] [${n}]${e.msg?.toString?e.msg.toString():e.msg}[/${n}]`,r.push(i)}eR.logs=eR.logs.filter(r=>eg.time()-r.time<(e.logTime||4));let i=t4({text:r.join(`
`),font:e0,pos:V(8,-8),anchor:"botleft",size:16,width:.6*t3(),lineSpacing:4,fixed:!0,styles:{time:{color:y(127,127,127)},info:{color:y(255,255,255)},error:{color:y(255,0,127)}}});tH({width:i.width+16,height:i.height+16,anchor:"botleft",color:y(0,0,0),radius:4,opacity:.8,fixed:!0}),t8(i),tN()})}function iD(e){eR.events.on("loading",e)}function iI(e){eg.onResize(e)}function ik(e){eR.events.on("error",e)}function iU(e){console.error(e),eE.ctx.suspend(),eg.run(()=>{tP(),t$(()=>{let r=t3(),i=t7(),n={size:36,width:r-64,letterSpacing:4,lineSpacing:4,font:e0,fixed:!0};tH({width:r,height:i,color:y(0,0,255),fixed:!0});let o=t4({...n,text:"Error",pos:V(32),color:y(255,128,0),fixed:!0});t8(o),t6({...n,text:e.message,pos:V(32,32+o.height+16),fixed:!0}),tN(),eR.events.trigger("error",e)}),tB()})}function iN(e){ew.push(e)}function iL(){eR.events.onOnce("frameEnd",()=>{eg.quit(),eA.clear(eA.COLOR_BUFFER_BIT|eA.DEPTH_BUFFER_BIT|eA.STENCIL_BUFFER_BIT);let e=eA.getParameter(eA.MAX_TEXTURE_IMAGE_UNITS);for(let r=0;r<e;r++)eA.activeTexture(eA.TEXTURE0+r),eA.bindTexture(eA.TEXTURE_2D,null),eA.bindTexture(eA.TEXTURE_CUBE_MAP,null);eA.bindBuffer(eA.ARRAY_BUFFER,null),eA.bindBuffer(eA.ELEMENT_ARRAY_BUFFER,null),eA.bindRenderbuffer(eA.RENDERBUFFER,null),eA.bindFramebuffer(eA.FRAMEBUFFER,null),eV.destroy(),ew.forEach(e=>e())})}o(iP,"checkFrame"),o(iT,"drawFrame"),o(iB,"drawLoadScreen"),o(iF,"drawInspectText"),o(iC,"drawDebug"),o(iD,"onLoading"),o(iI,"onResize"),o(ik,"onError"),o(iU,"handleErr"),o(iN,"onCleanup"),o(iL,"quit");let iO=!0;function iG(){let r=eA.drawingBufferWidth/X,i=eA.drawingBufferHeight/X;if(e.letterbox){if(!e.width||!e.height)throw Error("Letterboxing requires width and height defined.");let n=r/i,o=e.width/e.height;if(n>o){let e=i*o;ev.viewport={x:(r-e)/2,y:0,width:e,height:i}}else{let e=r/o;ev.viewport={x:0,y:(i-e)/2,width:r,height:e}}return}if(e.stretch&&(!e.width||!e.height))throw Error("Stretching requires width and height defined.");ev.viewport={x:0,y:0,width:r,height:i}}function iq(){eg.onHide(()=>{e.backgroundAudio||eE.ctx.suspend()}),eg.onShow(()=>{e.backgroundAudio||ri.paused||eE.ctx.resume()}),eg.onResize(()=>{if(eg.isFullscreen())return;let r=e.width&&e.height;r&&!e.stretch&&!e.letterbox||(l.width=l.offsetWidth*X,l.height=l.offsetHeight*X,iG(),r||(ev.frameBuffer.free(),ev.frameBuffer=new ek(eV,eA.drawingBufferWidth,eA.drawingBufferHeight),ev.width=eA.drawingBufferWidth/X,ev.height=eA.drawingBufferHeight/X))}),!1!==e.debug&&(eg.onKeyPress("f1",()=>ri.inspect=!ri.inspect),eg.onKeyPress("f2",()=>ri.clearLog()),eg.onKeyPress("f8",()=>ri.paused=!ri.paused),eg.onKeyPress("f7",()=>{ri.timeScale=rI(f(ri.timeScale-.2,0,2),1)}),eg.onKeyPress("f9",()=>{ri.timeScale=rI(f(ri.timeScale+.2,0,2),1)}),eg.onKeyPress("f10",()=>ri.stepFrame())),e.burp&&eg.onKeyPress("b",()=>tx())}eg.run(()=>{try{eS.loaded||1!==eP()||iO||(eS.loaded=!0,eR.events.trigger("load")),!eS.loaded&&!1!==e.loadingScreen||iO?(tP(),iB()):(ri.paused||iR(),iP(),tP(),iT(),!1!==e.debug&&iC()),tB(),iO&&(iO=!1),eR.events.trigger("frameEnd")}catch(e){iU(e)}}),o(iG,"updateViewport"),o(iq,"initEvents"),iG(),iq();let iH={VERSION:"3000.1.17",loadRoot:eT,loadProgress:eP,loadSprite:ti,loadSpriteAtlas:ez,loadSound:th,loadBitmapFont:eL,loadFont:eC,loadShader:to,loadShaderURL:ta,loadAseprite:ts,loadPedit:tn,loadBean:tl,loadJSON:eB,load:eM,getSprite:tu,getSound:td,getFont:tc,getBitmapFont:tf,getShader:tp,getAsset:tg,Asset:eG,SpriteData:ey,SoundData:ex,width:t3,height:t7,center:ia,dt:rn,time:eg.time,screenshot:eg.screenshot,record:id,isFocused:ic,setCursor:eg.setCursor,getCursor:eg.getCursor,setCursorLocked:eg.setCursorLocked,isCursorLocked:eg.isCursorLocked,setFullscreen:eg.setFullscreen,isFullscreen:eg.isFullscreen,isTouchscreen:eg.isTouchscreen,onLoad:r9,onLoading:iD,onResize:iI,onGamepadConnect:eg.onGamepadConnect,onGamepadDisconnect:eg.onGamepadDisconnect,onError:ik,onCleanup:iN,camPos:rs,camScale:ro,camRot:ra,shake:rh,toScreen:rl,toWorld:ru,setGravity:rR,getGravity:rM,setBackground:rP,getBackground:rT,getGamepads:eg.getGamepads,add:ig,make:rc,destroy:ip,destroyAll:iw,get:iA,readd:im,pos:rB,scale:rF,rotate:rC,color:rD,opacity:rk,anchor:rU,area:rH,sprite:rY,text:rj,polygon:rQ,rect:rz,circle:rX,uvquad:rJ,outline:rW,body:r_,doubleJump:r$,shader:r0,timer:rZ,fixed:r1,stay:r2,health:r5,lifespan:r4,z:rN,move:rO,offscreen:rG,follow:rL,state:r6,fadeIn:r8,mask:r3,drawon:r7,tile:ih,agent:iu,on:rf,onUpdate:rp,onDraw:rg,onAdd:rm,onDestroy:rw,onClick:rx,onCollide:rA,onCollideUpdate:rV,onCollideEnd:rv,onHover:rE,onHoverUpdate:rS,onHoverEnd:rb,onKeyDown:eg.onKeyDown,onKeyPress:eg.onKeyPress,onKeyPressRepeat:eg.onKeyPressRepeat,onKeyRelease:eg.onKeyRelease,onMouseDown:eg.onMouseDown,onMousePress:eg.onMousePress,onMouseRelease:eg.onMouseRelease,onMouseMove:eg.onMouseMove,onCharInput:eg.onCharInput,onTouchStart:eg.onTouchStart,onTouchMove:eg.onTouchMove,onTouchEnd:eg.onTouchEnd,onScroll:eg.onScroll,onHide:eg.onHide,onShow:eg.onShow,onGamepadButtonDown:eg.onGamepadButtonDown,onGamepadButtonPress:eg.onGamepadButtonPress,onGamepadButtonRelease:eg.onGamepadButtonRelease,onGamepadStick:eg.onGamepadStick,mousePos:rt,mouseDeltaPos:eg.mouseDeltaPos,isKeyDown:eg.isKeyDown,isKeyPressed:eg.isKeyPressed,isKeyPressedRepeat:eg.isKeyPressedRepeat,isKeyReleased:eg.isKeyReleased,isMouseDown:eg.isMouseDown,isMousePressed:eg.isMousePressed,isMouseReleased:eg.isMouseReleased,isMouseMoved:eg.isMouseMoved,isGamepadButtonPressed:eg.isGamepadButtonPressed,isGamepadButtonDown:eg.isGamepadButtonDown,isGamepadButtonReleased:eg.isGamepadButtonReleased,getGamepadStick:eg.getGamepadStick,charInputted:eg.charInputted,loop:iv,wait:iV,play:ty,volume:tv,burp:tx,audioCtx:eE.ctx,Line:Q,Rect:z,Circle:J,Polygon:W,Vec2:A,Color:v,Mat4:R,Quad:E,RNG:T,rand:C,randi:D,randSeed:F,vec2:V,rgb:y,hsl2rgb:x,quad:S,choose:k,chance:I,lerp:g,tween:iy,easings:eX,map:m,mapc:w,wave:P,deg2rad:u,rad2deg:c,clamp:f,testLineLine:L,testRectRect:U,testRectLine:O,testRectPoint:G,testCirclePolygon:Y,testLinePoint:q,testLineCircle:H,drawSprite:tG,drawText:t6,formatText:t4,drawRect:tH,drawLine:tK,drawLines:tY,drawTriangle:tj,drawCircle:tQ,drawEllipse:tz,drawUVQuad:tL,drawPolygon:tJ,drawFormattedText:t8,drawMasked:tW,drawSubtracted:tZ,pushTransform:tU,popTransform:tN,pushTranslate:tD,pushScale:tI,pushRotate:tk,pushMatrix:tC,usePostEffect:tT,makeCanvas:tE,debug:ri,scene:ie,go:it,onSceneLeave:ir,addLevel:il,getData:ii,setData:is,download:es,downloadJSON:ea,downloadText:eo,downloadBlob:eh,plug:io,ASCII_CHARS:e_,canvas:eg.canvas,addKaboom:ib,LEFT:A.LEFT,RIGHT:A.RIGHT,UP:A.UP,DOWN:A.DOWN,RED:v.RED,GREEN:v.GREEN,BLUE:v.BLUE,YELLOW:v.YELLOW,MAGENTA:v.MAGENTA,CYAN:v.CYAN,WHITE:v.WHITE,BLACK:v.BLACK,quit:iL,Event:ee,EventHandler:et,EventController:$};if(e.plugins&&e.plugins.forEach(io),!1!==e.global)for(let e in iH)window[e]=iH[e];return!1!==e.focus&&eg.canvas.focus(),iH},"default")}};